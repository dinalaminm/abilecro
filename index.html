<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡¶Ü‡¶¨‡ßç‡¶¶‡ßÅ‡¶≤‡ßç‡¶≤‡¶æ‡¶π ‡¶á‡¶≤‡ßá‡¶ï‡¶ü‡ßç‡¶∞‡¶ø‡¶ï - ‡¶¨‡¶ø‡¶≤ ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶ú‡¶Æ‡ßá‡¶®‡ßç‡¶ü</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">

    <!-- Firebase SDK Scripts -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

    <style>
        :root {
            --primary-blue: #4A90E2; --primary-blue-dark: #0052D4;
            --light-blue-bg: #F0F4FF; --white-color: #FFFFFF;
            --text-dark: #1E293B; --text-light: #64748B;
            --border-color: #E2E8F0;
            --danger-red: #EF4444; --danger-red-dark: #B91C1C;
            --success-green: #10B981;
        }
        * {
            box-sizing: border-box;
        }
        body {
            font-family: 'Poppins', sans-serif;
            margin: 0;
            padding: 0;
            background-color: var(--light-blue-bg);
            color: var(--text-dark);
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            padding-top: 80px; /* ‡¶®‡ßç‡¶Ø‡¶æ‡¶≠‡¶ø‡¶ó‡ßá‡¶∂‡¶® ‡¶¨‡¶æ‡¶∞‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶∏‡ßç‡¶™‡ßá‡¶∏ */
            padding-bottom: 80px;
        }

        /* ‡¶®‡ßç‡¶Ø‡¶æ‡¶≠‡¶ø‡¶ó‡ßá‡¶∂‡¶® ‡¶¨‡¶æ‡¶∞ ‡¶∏‡ßç‡¶ü‡¶æ‡¶á‡¶≤ */
        .navbar {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 60px;
            background: linear-gradient(to right, var(--primary-blue), var(--primary-blue-dark));
            color: white;
            z-index: 1001;
            transition: transform 0.3s ease;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .navbar.hidden {
            transform: translateY(-100%);
        }
        .nav-container {
            display: flex;
            align-items: center;
            height: 100%;
            padding: 0 20px;
            max-width: 900px;
            margin: 0 auto;
        }
        .nav-logo {
            height: 40px;
            margin-right: 15px;
            border-radius: 6px;
        }
        .nav-title {
            font-size: 18px;
            font-weight: 600;
            margin: 0;
            flex-grow: 1;
        }

        /* ‡¶Æ‡ßá‡¶®‡ßÅ ‡¶¨‡¶æ‡¶ü‡¶® ‡¶∏‡ßç‡¶ü‡¶æ‡¶á‡¶≤ */
        .menu-btn {
            display: flex !important;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            font-size: 24px;
            color: white;
            cursor: pointer;
            margin-right: 15px;
            border-radius: 8px;
            transition: background-color 0.3s ease;
        }
        .menu-btn:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }

        .container {
            max-width: 900px;
            margin: auto;
            padding: 20px;
            background: var(--white-color);
            border-radius: 24px;
            box-shadow: 0 10px 30px rgba(65, 87, 128, 0.1);
            margin-top: 20px;
        }
        .header-bar {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
        }
        .header-logo {
            height: 50px;
            margin-right: 15px;
            border-radius: 8px;
        }
        .header-bar .menu-btn {
            display: none !important;
        }
        h1 {
            text-align: center;
            margin: 0;
            color: var(--text-dark);
            font-weight: 700;
            flex-grow: 1;
            font-size: 24px;
        }

        .sidenav {
            height: 100%;
            width: 0;
            position: fixed;
            z-index: 1002; /* z-index ‡¶¨‡¶æ‡¶°‡¶º‡¶æ‡¶®‡ßã ‡¶π‡ßü‡ßá‡¶õ‡ßá */
            top: 0;
            left: 0;
            background-color: var(--white-color);
            overflow-x: hidden;
            transition: 0.5s;
            box-shadow: 3px 0 15px rgba(0,0,0,0.1);
            display: flex;
            flex-direction: column;
        }
        .sidenav .sidenav-header {
            padding: 20px 25px;
            font-size: 22px;
            font-weight: 600;
            color: var(--white-color);
            background-image: linear-gradient(to right, var(--primary-blue), var(--primary-blue-dark));
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .sidenav a {
            padding: 15px 15px 15px 32px;
            text-decoration: none;
            font-size: 17px;
            color: var(--text-dark);
            display: flex;
            align-items: center;
            gap: 15px;
            transition: 0.3s;
            border-left: 4px solid transparent;
        }
        .sidenav a:hover {
            background-color: var(--light-blue-bg);
            color: var(--primary-blue);
            border-left-color: var(--primary-blue);
        }
        .sidenav .close-btn {
            position: static;
            font-size: 32px;
            color: var(--white-color);
            text-decoration: none;
            border-left: none;
            padding: 0;
            line-height: 1;
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: background-color 0.3s;
        }
        .sidenav .close-btn:hover {
            background-color: rgba(255, 255, 255, 0.15);
            border-left-color: transparent;
            color: var(--white-color);
        }
        .sidenav-divider {
            border: none;
            border-top: 1px solid var(--border-color);
            margin: 10px 25px;
        }
        .sidenav-footer {
            margin-top: auto;
            padding: 20px 32px;
            font-size: 13px;
            color: var(--text-light);
        }

        #main-content, #history-page, #shop-page, #home-page, .bottom-nav, .fab-add {
            transition: filter 0.5s ease-out;
        }
        .content-blur {
            filter: blur(5px);
            pointer-events: none;
            user-select: none;
        }

        /* ‡¶π‡ßã‡¶Æ ‡¶™‡ßá‡¶ú ‡¶∏‡ßç‡¶ü‡¶æ‡¶á‡¶≤‡¶∏ */
        #home-page {
            display: block;
            margin-top: -20px; /* ‡¶∏‡ßç‡¶≤‡¶æ‡¶á‡¶°‡¶æ‡¶∞‡¶ï‡ßá ‡¶è‡¶ï‡¶ü‡ßÅ ‡¶â‡¶™‡¶∞‡ßá ‡¶§‡ßÅ‡¶≤‡¶§‡ßá */
        }
        .home-container {
            max-width: 100%;
            margin: 0;
            padding: 0;
        }

        /* 16:9 ‡¶∞‡ßá‡¶∂‡¶ø‡¶ì ‡¶∏‡ßç‡¶≤‡¶æ‡¶á‡¶°‡¶æ‡¶∞ - ‡¶è‡¶ï‡¶¶‡¶Æ ‡¶â‡¶™‡¶∞‡ßá */
        .slider-section {
            margin: 0;
            width: 100%;
        }
        .slider-container {
            position: relative;
            width: 100%;
            border-radius: 0;
            overflow: hidden;
            background: var(--white-color);
        }
        .slider {
            position: relative;
            width: 100%;
            aspect-ratio: 16/9; /* 16:9 ‡¶∞‡ßá‡¶∂‡¶ø‡¶ì */
            overflow: hidden;
        }
        .slides {
            display: flex;
            transition: transform 0.5s ease-in-out;
            height: 100%;
        }
        .slide {
            min-width: 100%;
            height: 100%;
            position: relative;
        }
        .slide-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .slide-content {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(transparent, rgba(0,0,0,0.8));
            color: white;
            padding: 20px;
        }
        .slide-title {
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 8px;
        }
        .slide-desc {
            font-size: 16px;
            opacity: 0.9;
        }
        .slider-nav {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 10px;
        }
        .nav-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: rgba(255,255,255,0.5);
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .nav-dot.active {
            background: white;
            transform: scale(1.3);
        }
        .slider-arrow {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(255,255,255,0.9);
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 20px;
            color: var(--text-dark);
            transition: all 0.3s ease;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
        }
        .slider-arrow:hover {
            background: white;
            transform: translateY(-50%) scale(1.1);
        }
        .slider-arrow.prev {
            left: 20px;
        }
        .slider-arrow.next {
            right: 20px;
        }

        .welcome-section {
            text-align: center;
            margin: 20px;
            padding: 30px 20px;
            background: linear-gradient(135deg, var(--primary-blue), var(--primary-blue-dark));
            border-radius: 20px;
            color: white;
        }
        .welcome-title {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 10px;
        }
        .welcome-subtitle {
            font-size: 16px;
            opacity: 0.9;
            margin-bottom: 20px;
        }
        .quick-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }
        .stat-card {
            background: var(--white-color);
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            border: 1px solid var(--border-color);
        }
        .stat-number {
            font-size: 32px;
            font-weight: 700;
            color: var(--primary-blue);
            margin-bottom: 5px;
        }
        .stat-label {
            font-size: 14px;
            color: var(--text-light);
            font-weight: 500;
        }
        .quick-actions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin: 20px;
        }
        .action-card {
            background: var(--white-color);
            padding: 25px 15px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            border: 1px solid var(--border-color);
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .action-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
            border-color: var(--primary-blue);
        }
        .action-icon {
            font-size: 32px;
            margin-bottom: 10px;
            display: block;
        }
        .action-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-dark);
            margin-bottom: 5px;
        }
        .action-desc {
            font-size: 12px;
            color: var(--text-light);
        }

        /* ‡¶¨‡¶æ‡¶ï‡¶ø ‡¶∏‡ßç‡¶ü‡¶æ‡¶á‡¶≤‡¶∏ */
        .customer-info{
            display:grid;
            grid-template-columns:1fr 1fr;
            gap:15px;
            margin-bottom:20px
        }
        input[type="text"], input[type="number"], input[type="date"], select {
            width: 100%;
            padding: 12px 16px;
            box-sizing: border-box;
            background: #F8FAFC;
            border: 1px solid var(--border-color);
            border-radius: 12px;
            font-size: 16px;
            font-family: 'Poppins', sans-serif;
            transition: all .3s ease;
        }

        input:focus, select:focus {
            outline: none;
            border-color: var(--primary-blue);
            box-shadow: 0 0 0 3px rgba(74, 144, 226, 0.2);
        }
        .date-field label {
            font-weight: 500;
            color: var(--text-dark);
            margin-bottom: 8px;
            display: block;
            font-size: 14px;
        }
        .full-width {
            grid-column: 1 / -1;
        }

        td input {
            min-width: 50px;
        }
        input.product-name {
            width: 100%;
            min-width: 15ch;
        }
        .quantity {
            width: 100%;
            min-width: 7ch;
            text-align: center;
        }
        .price {
            width: 100%;
            min-width: 8ch;
            text-align: right;
        }
        .amount {
            width: 100%;
            min-width: 9ch;
            text-align: right;
        }

        .table-wrapper{
            overflow-x:auto;
            -webkit-overflow-scrolling: touch;
        }
        table{
            width:100%;
            border-collapse:collapse;
            margin-bottom:20px;
        }
        th,td{
            padding:14px 10px;
            text-align:center;
            border-bottom:1px solid var(--border-color);
            vertical-align:middle;
            white-space: nowrap;
        }
        th{
            background-color:var(--primary-blue);
            color:white;
            font-weight:600;
            font-size:15px;
            padding:16px 12px;
            letter-spacing:.5px;
            text-transform:uppercase;
            border-right:1px solid rgba(255,255,255,.15)
        }
        th:nth-child(2), td:nth-child(2){
            text-align:left;
            white-space: normal;
            word-break: break-word;
        }

        th:first-child{
            border-radius:10px 0 0 10px
        }
        th:last-child{
            border-radius:0 10px 10px 0;
            border-right:none
        }
        tr:last-child td{
            border-bottom:none
        }

        .btn{
            padding:12px 24px;
            border:none;
            border-radius:12px;
            cursor:pointer;
            font-size:16px;
            font-family:'Poppins',sans-serif;
            transition:all .3s ease;
            font-weight:600;
            color:white;
            background-size:200% auto;
            box-shadow:0 4px 15px rgba(0,0,0,.1)
        }
        .btn:hover{
            background-position:right center;
            transform:translateY(-2px);
            box-shadow:0 6px 20px rgba(0,0,0,.15)
        }
        .btn-add{
            background-image:linear-gradient(to right,var(--primary-blue) 0%,var(--primary-blue-dark) 51%,var(--primary-blue) 100%)
        }
        .btn-remove{
            background:#F1F5F9;
            color:var(--text-light);
            box-shadow:none;
            padding: 8px 12px;
            font-size: 14px;
        }
        .btn-remove:hover{
            background:#E2E8F0;
            color:var(--text-dark);
            transform:none;
            box-shadow:none
        }
        .btn-delete {
            background-image: linear-gradient(to right, var(--danger-red) 0%, var(--danger-red-dark) 51%, var(--danger-red) 100%);
        }
        .btn-print{
            background-image:linear-gradient(to right,var(--primary-blue) 0%,var(--primary-blue-dark) 51%,var(--primary-blue) 100%);
            display:block;
            width:100%;
            margin-top:20px;
            padding:16px;
            font-size:18px;
            font-weight:700
        }
        .totals-container{
            float:right;
            width:300px;
            background:var(--light-blue-bg);
            padding:20px;
            border-radius:16px;
            margin-top:15px
        }
        .totals-table{
            width:100%;
            border:none
        }
        .totals-table td{
            border:none;
            padding:10px;
            font-size:16px;
            text-align:left
        }
        .text-right{
            text-align:right!important;
            font-weight:700
        }
        .clearfix::after{
            content:"";
            clear:both;
            display:table
        }
        .modal{
            display:none;
            position:fixed;
            z-index:2000;
            left:0;
            top:0;
            width:100%;
            height:100%;
            overflow:auto;
            background-color:rgba(0,0,0,.5)
        }
        .modal-content{
            background-color:#fefefe;
            margin:5% auto;
            padding:25px;
            border:1px solid #888;
            width:90%;
            max-width:850px; /* ‡¶™‡ßç‡¶∞‡¶∏‡ßç‡¶• ‡¶¨‡¶æ‡ßú‡¶æ‡¶®‡ßã ‡¶π‡ßü‡ßá‡¶õ‡ßá */
            border-radius:15px
        }
        .modal-header{
            display:flex;
            justify-content:space-between;
            align-items:center;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 15px;
            margin-bottom: 15px;
        }
        .modal-header h2{
            margin:0;
            font-size: 20px;
        }
        .modal-close-btn{
            color:#aaa;
            font-size:28px;
            font-weight:bold;
            cursor:pointer
        }
        #history-list{
            list-style:none;
            padding:0;
            margin-top:20px
        }

        .date-history-item {
            background: #fff;
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 15px 20px;
            margin-bottom: 12px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s ease;
        }
        .date-history-item:hover {
            border-color: var(--primary-blue);
            box-shadow: 0 4px 15px rgba(74, 144, 226, 0.1);
            transform: translateY(-2px);
        }
        .date-primary-info .date-header {
            font-size: 18px;
            font-weight: 600;
            color: var(--text-dark);
            margin-bottom: 5px;
        }
        .date-primary-info .memo-count {
            font-size: 14px;
            color: var(--text-light);
        }
        .date-totals-info {
            text-align: right;
        }
        .date-totals-info .total-item {
            font-size: 15px;
            margin-bottom: 5px;
        }
        .date-totals-info .total-item:last-child {
            margin-bottom: 0;
        }
        .date-totals-info .total-item span {
            color: var(--text-light);
            margin-right: 10px;
        }
        .date-totals-info .total-item strong {
            font-weight: 600;
            color: var(--primary-blue-dark);
        }
        .date-totals-info .total-item.advance strong {
            color: var(--success-green);
        }

        #history-list .memo-list-item {
            display:flex;
            justify-content:space-between;
            align-items:center;
            padding:12px 0;
            border-bottom:1px solid var(--border-color);
            flex-wrap: wrap;
            gap: 10px;
        }
        #history-list .memo-list-item:last-child {
            border-bottom: none;
        }
        .memo-list-item .controls button {
            padding:6px 12px;
            font-size:14px;
            margin-left: 5px;
        }

        .modal-body {
            line-height: 1.8;
            color: var(--text-light);
        }
        .modal-body h3 {
            color: var(--text-dark);
            font-weight: 600;
        }
        .modal-body p {
            margin-bottom: 15px;
        }

        .empty-state-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 80px 20px;
            text-align: center;
        }
        .empty-state-icon {
            width: 100px;
            height: 100px;
            background-color: #f1f5f9;
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 25px;
        }
        .empty-state-icon svg {
            width: 50px;
            height: 50px;
            stroke: #94a3b8;
        }
        .empty-state-title {
            font-size: 22px;
            font-weight: 600;
            color: var(--text-dark);
            margin: 0 0 10px 0;
        }
        .empty-state-subtitle {
            font-size: 16px;
            color: var(--text-light);
            margin: 0;
            max-width: 300px;
        }

        .fab-add {
            position: fixed;
            bottom: 85px;
            right: 25px;
            width: 60px;
            height: 60px;
            background-image: linear-gradient(to right, var(--primary-blue) 0%, var(--primary-blue-dark) 51%, var(--primary-blue) 100%);
            background-size: 200% auto;
            color: white;
            border: none;
            border-radius: 50%;
            font-size: 30px;
            line-height: 60px;
            text-align: center;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            cursor: pointer;
            z-index: 1000;
            transition: all 0.3s ease;
        }
        .fab-add:hover {
            background-position: right center;
            transform: scale(1.05);
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.25);
        }

        .shop-edit-form label {
            display: block;
            margin-top: 15px;
            margin-bottom: 5px;
            font-weight: 500;
        }
        .shop-edit-form input {
            margin-bottom: 10px;
        }

        /* ‡¶≤‡ßã‡¶ó‡ßã ‡¶∏‡¶π ‡¶°‡ßç‡¶∞‡¶™‡¶°‡¶æ‡¶â‡¶® ‡¶∏‡ßç‡¶ü‡¶æ‡¶á‡¶≤‡¶∏ */
        .shop-dropdown {
            position: relative;
            margin-bottom: 20px;
        }
        .custom-dropdown {
            position: relative;
            width: 100%;
        }
        .custom-dropdown-select {
            width: 100%;
            padding: 12px 16px;
            background: #F8FAFC;
            border: 1px solid var(--border-color);
            border-radius: 12px;
            font-size: 16px;
            font-family: 'Poppins', sans-serif;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: space-between;
            transition: all 0.3s ease;
        }
        .custom-dropdown-select:hover {
            border-color: var(--primary-blue);
        }
        .custom-dropdown-select:focus {
            outline: none;
            border-color: var(--primary-blue);
            box-shadow: 0 0 0 3px rgba(74, 144, 226, 0.2);
        }
        .custom-dropdown-options {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 1px solid var(--border-color);
            border-radius: 12px;
            margin-top: 5px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            z-index: 1000;
            max-height: 300px;
            overflow-y: auto;
            display: none;
        }
        .custom-dropdown-option {
            padding: 12px 16px;
            display: flex;
            align-items: center;
            gap: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            border-bottom: 1px solid var(--border-color);
        }
        .custom-dropdown-option:last-child {
            border-bottom: none;
        }
        .custom-dropdown-option:hover {
            background: var(--light-blue-bg);
        }
        .custom-dropdown-option.selected {
            background: var(--primary-blue);
            color: white;
        }
        .custom-dropdown-option-logo {
            width: 30px;
            height: 30px;
            border-radius: 6px;
            object-fit: cover;
            flex-shrink: 0;
        }
        .custom-dropdown-option-text {
            flex-grow: 1;
        }
        .custom-dropdown-option-name {
            font-weight: 500;
            font-size: 14px;
        }
        .custom-dropdown-option-contact {
            font-size: 12px;
            color: var(--text-light);
            margin-top: 2px;
        }
        .custom-dropdown.selected .custom-dropdown-options {
            display: block;
        }
        .custom-dropdown-chevron {
            transition: transform 0.3s ease;
        }
        .custom-dropdown.selected .custom-dropdown-chevron {
            transform: rotate(180deg);
        }

        /* ‡¶∂‡¶™ ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶ú‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶∏‡ßç‡¶ü‡¶æ‡¶á‡¶≤‡¶∏ */
        .shop-management-section {
            margin-top: 30px;
        }
        .shop-management-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        .shop-management-title {
            font-size: 20px;
            font-weight: 600;
            color: var(--text-dark);
        }
        .shop-list {
            display: grid;
            gap: 15px;
        }
        .shop-item {
            background: #fff;
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
            transition: all 0.3s ease;
        }
        .shop-item:hover {
            border-color: var(--primary-blue);
            box-shadow: 0 4px 15px rgba(74, 144, 226, 0.1);
        }
        .shop-item-logo {
            width: 60px;
            height: 60px;
            border-radius: 8px;
            object-fit: cover;
        }
        .shop-item-info {
            flex-grow: 1;
        }
        .shop-item-name {
            font-size: 18px;
            font-weight: 600;
            margin: 0 0 5px 0;
            color: var(--text-dark);
        }
        .shop-item-details {
            font-size: 14px;
            color: var(--text-light);
            margin: 0;
        }
        .shop-item-actions {
            display: flex;
            gap: 10px;
        }
        .shop-item-action-btn {
            padding: 8px 16px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-family: 'Poppins', sans-serif;
            font-weight: 500;
            transition: all 0.3s ease;
        }
        .shop-item-edit {
            background: var(--primary-blue);
            color: white;
        }
        .shop-item-delete {
            background: var(--danger-red);
            color: white;
        }
        .shop-item-action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        /* Bottom Navigation */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            height: 65px;
            background-color: var(--white-color);
            display: flex;
            justify-content: space-around;
            align-items: center;
            box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.08);
            z-index: 999;
            transition: transform 0.3s ease; /* ‡¶®‡¶§‡ßÅ‡¶® ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶® */
        }
        /* ‡¶®‡¶§‡ßÅ‡¶® ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶® */
        .bottom-nav.hidden {
            transform: translateY(100%);
        }
        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: var(--text-light);
            text-decoration: none;
            font-size: 12px;
            font-weight: 500;
            gap: 4px;
            padding: 8px 12px;
            border-radius: 8px;
            transition: color 0.3s, background-color 0.3s;
        }
        .nav-item svg {
            width: 24px;
            height: 24px;
        }
        .nav-item:hover {
            color: var(--primary-blue);
        }
        .nav-item.active {
            color: var(--primary-blue-dark);
            font-weight: 600;
        }
        
    </style>
</head>
<body>
    <!-- ‡¶®‡ßç‡¶Ø‡¶æ‡¶≠‡¶ø‡¶ó‡ßá‡¶∂‡¶® ‡¶¨‡¶æ‡¶∞ -->
    <div class="navbar" id="navbar">
        <div class="nav-container">
            <span class="menu-btn" onclick="openNav()">&#9776;</span>
            <img src="https://i.ibb.co/fYwdd8h/IMG-20251107-WA0006.jpg" alt="Shop Logo" class="nav-logo">
            <h1 class="nav-title">‡¶Ü‡¶¨‡ßç‡¶¶‡ßÅ‡¶≤‡ßç‡¶≤‡¶æ‡¶π ‡¶á‡¶≤‡ßá‡¶ï‡¶ü‡ßç‡¶∞‡¶ø‡¶ï</h1>
        </div>
    </div>
    
    <div id="mySidenav" class="sidenav">
        <div class="sidenav-header">
            <span>‡¶Æ‡ßá‡¶®‡ßÅ</span>
            <a href="javascript:void(0)" class="close-btn" onclick="closeNav()">&times;</a>
        </div>
        <a href="#" id="side-home-btn">üè† <span>‡¶π‡ßã‡¶Æ</span></a>
        <a href="#" id="side-new-memo-btn">‚ûï <span>‡¶®‡¶§‡ßÅ‡¶® ‡¶Æ‡ßá‡¶Æ‡ßã</span></a>
        <a href="#" id="side-show-history-btn">üìú <span>‡¶Æ‡ßá‡¶Æ‡ßã‡¶∞ ‡¶á‡¶§‡¶ø‡¶π‡¶æ‡¶∏</span></a>
        
        <hr class="sidenav-divider">
        <a href="#" id="side-shop-btn">üè™ <span>‡¶Ü‡¶Æ‡¶æ‡¶¶‡ßá‡¶∞ ‡¶¶‡ßã‡¶ï‡¶æ‡¶®</span></a>
        <a href="#" id="side-privacy-btn">üîí <span>‡¶ó‡ßã‡¶™‡¶®‡ßÄ‡¶Ø‡¶º‡¶§‡¶æ ‡¶®‡ßÄ‡¶§‡¶ø</span></a>

        <div class="sidenav-footer">
            ‡¶∏‡¶Ç‡¶∏‡ßç‡¶ï‡¶∞‡¶£ ‡ßß.‡ßß‡ß®
        </div>
    </div>

    <!-- ‡¶π‡ßã‡¶Æ ‡¶™‡ßá‡¶ú -->
    <div id="home-page">
        <div class="home-container">
            <!-- 16:9 ‡¶∞‡ßá‡¶∂‡¶ø‡¶ì ‡¶∏‡ßç‡¶≤‡¶æ‡¶á‡¶°‡¶æ‡¶∞ - ‡¶è‡¶ï‡¶¶‡¶Æ ‡¶â‡¶™‡¶∞‡ßá -->
            <div class="slider-section">
                <div class="slider-container">
                    <div class="slider">
                        <div class="slides" id="slides">
                            <div class="slide">
                                <img src="https://images.unsplash.com/photo-1563013541-314ef36ad4fc?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxzZWFyY2h8Mnx8ZWxlY3RyaWNhbCUyMGFwcGxpYW5jZXN8ZW58MHx8MHx8fDA%3D&auto=format&fit=crop&w=1200&q=80" alt="‡¶á‡¶≤‡ßá‡¶ï‡¶ü‡ßç‡¶∞‡¶ø‡¶ï ‡¶Ü‡¶á‡¶ü‡ßá‡¶Æ" class="slide-image">
                                <div class="slide-content">
                                    <div class="slide-title">‡¶á‡¶≤‡ßá‡¶ï‡¶ü‡ßç‡¶∞‡¶®‡¶ø‡¶ï ‡¶Ü‡¶á‡¶ü‡ßá‡¶Æ</div>
                                    <div class="slide-desc">‡¶∏‡¶ï‡¶≤ ‡¶™‡ßç‡¶∞‡¶ï‡¶æ‡¶∞ ‡¶á‡¶≤‡ßá‡¶ï‡¶ü‡ßç‡¶∞‡¶®‡¶ø‡¶ï ‡¶∏‡¶æ‡¶Æ‡¶ó‡ßç‡¶∞‡ßÄ</div>
                                </div>
                            </div>
                            <div class="slide">
                                <img src="https://images.unsplash.com/photo-1558618047-3c8c76ca7d13?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxzZWFyY2h8M3x8ZWxlY3RyaWNhbCUyMGRldmljZXN8ZW58MHx8MHx8fDA%3D&auto=format&fit=crop&w=1200&q=80" alt="‡¶á‡¶≤‡ßá‡¶ï‡¶ü‡ßç‡¶∞‡¶ø‡¶ï ‡¶°‡¶ø‡¶≠‡¶æ‡¶á‡¶∏" class="slide-image">
                                <div class="slide-content">
                                    <div class="slide-title">‡¶á‡¶≤‡ßá‡¶ï‡¶ü‡ßç‡¶∞‡¶ø‡¶ï ‡¶°‡¶ø‡¶≠‡¶æ‡¶á‡¶∏</div>
                                    <div class="slide-desc">‡¶Ü‡¶ß‡ßÅ‡¶®‡¶ø‡¶ï ‡¶á‡¶≤‡ßá‡¶ï‡¶ü‡ßç‡¶∞‡¶ø‡¶ï ‡¶Ø‡¶®‡ßç‡¶§‡ßç‡¶∞‡¶™‡¶æ‡¶§‡¶ø</div>
                                </div>
                            </div>
                            <div class="slide">
                                <img src="https://images.unsplash.com/photo-1581093458791-8a0a1ed12789?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxzZWFyY2h8MTB8fGVsZWN0cmljYWwlMjBkZXZpY2VzfGVufDB8fDB8fHww&auto=format&fit=crop&w=1200&q=80" alt="‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶ø‡¶∏" class="slide-image">
                                <div class="slide-content">
                                    <div class="slide-title">‡¶™‡ßá‡¶∂‡¶æ‡¶¶‡¶æ‡¶∞ ‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶ø‡¶∏</div>
                                    <div class="slide-desc">‡¶¨‡¶ø‡¶∂‡ßá‡¶∑‡¶ú‡ßç‡¶û ‡¶ü‡ßá‡¶ï‡¶®‡¶ø‡¶∂‡¶ø‡¶Ø‡¶º‡¶æ‡¶® ‡¶¶‡ßç‡¶¨‡¶æ‡¶∞‡¶æ ‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶ø‡¶∏</div>
                                </div>
                            </div>
                            <div class="slide">
                                <img src="https://images.unsplash.com/photo-1558618666-fcd25856cd25?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxzZWFyY2h8MTJ8fGVsZWN0cmljYWwlMjBkZXZpY2VzfGVufDB8fDB8fHww&auto=format&fit=crop&w=1200&q=80" alt="‡¶∏‡¶æ‡¶™‡ßã‡¶∞‡ßç‡¶ü" class="slide-image">
                                <div class="slide-content">
                                    <div class="slide-title">‡ß®‡ß™/‡ß≠ ‡¶∏‡¶æ‡¶™‡ßã‡¶∞‡ßç‡¶ü</div>
                                    <div class="slide-desc">‡¶Ø‡ßá‡¶ï‡ßã‡¶®‡ßã ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ‡¶Ø‡¶º ‡¶Ü‡¶Æ‡¶∞‡¶æ ‡¶Ü‡¶õ‡¶ø ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶™‡¶æ‡¶∂‡ßá</div>
                                </div>
                            </div>
                        </div>
                        <button class="slider-arrow prev" onclick="prevSlide()">‚ùÆ</button>
                        <button class="slider-arrow next" onclick="nextSlide()">‚ùØ</button>
                        <div class="slider-nav" id="slider-nav">
                            <!-- ‡¶®‡ßá‡¶≠‡¶ø‡¶ó‡ßá‡¶∂‡¶® ‡¶°‡¶ü‡¶∏ ‡¶°‡¶æ‡¶á‡¶®‡¶æ‡¶Æ‡¶ø‡¶ï‡¶≠‡¶æ‡¶¨‡ßá ‡¶Ø‡ßã‡¶ó ‡¶π‡¶¨‡ßá -->
                        </div>
                    </div>
                </div>
            </div>

            <div class="welcome-section">
                <h1 class="welcome-title">‡¶Ü‡¶¨‡ßç‡¶¶‡ßÅ‡¶≤‡ßç‡¶≤‡¶æ‡¶π ‡¶á‡¶≤‡ßá‡¶ï‡¶ü‡ßç‡¶∞‡¶ø‡¶ï</h1>
                <p class="welcome-subtitle">‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶¨‡ßç‡¶Ø‡¶¨‡¶∏‡¶æ‡¶Ø‡¶º‡¶ø‡¶ï ‡¶π‡¶ø‡¶∏‡¶æ‡¶¨ ‡¶¨‡ßç‡¶Ø‡¶¨‡¶∏‡ßç‡¶•‡¶æ‡¶™‡¶®‡¶æ ‡¶∏‡¶π‡¶ú ‡¶ï‡¶∞‡ßÅ‡¶®</p>
                <div class="quick-stats" id="home-stats">
                    <!-- ‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶ü‡¶ø‡¶∏‡ßç‡¶ü‡¶ø‡¶ï‡ßç‡¶∏ ‡¶°‡¶æ‡¶á‡¶®‡¶æ‡¶Æ‡¶ø‡¶ï‡¶≠‡¶æ‡¶¨‡ßá ‡¶≤‡ßã‡¶° ‡¶π‡¶¨‡ßá -->
                </div>
            </div>

            <div class="quick-actions">
                <div class="action-card" onclick="showMemoPage()">
                    <span class="action-icon">üìä</span>
                    <div class="action-title">‡¶®‡¶§‡ßÅ‡¶® ‡¶Æ‡ßá‡¶Æ‡ßã</div>
                    <div class="action-desc">‡¶¶‡ßç‡¶∞‡ßÅ‡¶§ ‡¶¨‡¶ø‡¶≤ ‡¶§‡ßà‡¶∞‡¶ø ‡¶ï‡¶∞‡ßÅ‡¶®</div>
                </div>
                <div class="action-card" onclick="showHistoryPage()">
                    <span class="action-icon">üìú</span>
                    <div class="action-title">‡¶Æ‡ßá‡¶Æ‡ßã ‡¶á‡¶§‡¶ø‡¶π‡¶æ‡¶∏</div>
                    <div class="action-desc">‡¶™‡ßÇ‡¶∞‡ßç‡¶¨‡ßá‡¶∞ ‡¶∏‡¶ï‡¶≤ ‡¶¨‡¶ø‡¶≤ ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®</div>
                </div>
                <div class="action-card" onclick="showShopPage()">
                    <span class="action-icon">üè™</span>
                    <div class="action-title">‡¶¶‡ßã‡¶ï‡¶æ‡¶® ‡¶¨‡ßç‡¶Ø‡¶¨‡¶∏‡ßç‡¶•‡¶æ‡¶™‡¶®‡¶æ</div>
                    <div class="action-desc">‡¶¶‡ßã‡¶ï‡¶æ‡¶® ‡¶Ø‡ßã‡¶ó ‡¶ì ‡¶∏‡¶Æ‡ßç‡¶™‡¶æ‡¶¶‡¶®‡¶æ</div>
                </div>
                <div class="action-card" onclick="resetForm(); showMemoPage();">
                    <span class="action-icon">‚ö°</span>
                    <div class="action-title">‡¶¶‡ßç‡¶∞‡ßÅ‡¶§ ‡¶∂‡ßÅ‡¶∞‡ßÅ</div>
                    <div class="action-desc">‡¶®‡¶§‡ßÅ‡¶® ‡¶¨‡¶ø‡¶≤ ‡¶§‡ßà‡¶∞‡¶ø ‡¶ï‡¶∞‡ßÅ‡¶®</div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- ‡¶®‡¶§‡ßÅ‡¶® ‡¶™‡ßç‡¶∞‡¶ø‡¶≠‡¶ø‡¶â ‡¶™‡ßá‡¶ú -->
    <div id="preview-page" style="display: none;">
        <!-- ‡¶Æ‡ßá‡¶Æ‡ßã ‡¶™‡ßç‡¶∞‡¶ø‡¶≠‡¶ø‡¶â ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶°‡¶æ‡¶á‡¶®‡¶æ‡¶Æ‡¶ø‡¶ï‡¶≠‡¶æ‡¶¨‡ßá ‡¶≤‡ßã‡¶° ‡¶π‡¶¨‡ßá -->
    </div>

    <div id="main-content" style="display: none;">
        <div class="container">
            <div class="header-bar">
                <img src="https://i.ibb.co/fYwdd8h/IMG-20251107-WA0006.jpg" alt="Shop Logo" class="header-logo" id="main-header-logo">
                <h1 id="main-header-title">‡¶¨‡¶ø‡¶≤ ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶ú‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶∏‡¶ø‡¶∏‡ßç‡¶ü‡ßá‡¶Æ</h1>
            </div>

            <!-- ‡¶≤‡ßã‡¶ó‡ßã ‡¶∏‡¶π ‡¶ï‡¶æ‡¶∏‡ßç‡¶ü‡¶Æ ‡¶°‡ßç‡¶∞‡¶™‡¶°‡¶æ‡¶â‡¶® -->
            <div class="shop-dropdown">
                <div class="custom-dropdown" id="shop-custom-dropdown">
                    <div class="custom-dropdown-select" id="shop-dropdown-select">
                        <div class="custom-dropdown-selected">
                            <span id="selected-shop-text">‡¶¶‡ßã‡¶ï‡¶æ‡¶® ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®...</span>
                        </div>
                        <svg class="custom-dropdown-chevron" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <polyline points="6 9 12 15 18 9"></polyline>
                        </svg>
                    </div>
                    <div class="custom-dropdown-options" id="shop-dropdown-options">
                        <!-- Options will be populated dynamically -->
                    </div>
                </div>
            </div>

            <div class="customer-info">
                <input type="text" id="memo-no" placeholder="‡¶Æ‡ßá‡¶Æ‡ßã ‡¶®‡¶Ç">
                <input type="text" id="customer-name" placeholder="‡¶ï‡ßç‡¶∞‡ßá‡¶§‡¶æ‡¶∞ ‡¶®‡¶æ‡¶Æ">
                <input type="text" id="customer-address" placeholder="‡¶ï‡ßç‡¶∞‡ßá‡¶§‡¶æ‡¶∞ ‡¶†‡¶ø‡¶ï‡¶æ‡¶®‡¶æ" class="full-width">
                <div class="date-field">
                    <label for="transaction-date">‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ</label>
                    <input type="date" id="transaction-date" title="‡¶≤‡ßá‡¶®‡¶¶‡ßá‡¶®‡ßá‡¶∞ ‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ">
                </div>
                <div class="date-field">
                    <label for="delivery-date">‡¶°‡ßá‡¶≤‡¶ø‡¶≠‡¶æ‡¶∞‡¶ø ‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ</label>
                    <input type="date" id="delivery-date" title="‡¶°‡ßá‡¶≤‡¶ø‡¶≠‡¶æ‡¶∞‡¶ø ‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ">
                </div>
            </div>

            <div class="table-wrapper">
                <table id="bill-table">
                    <thead>
                        <tr>
                            <th>‡¶®‡¶Ç</th><th>‡¶¨‡¶ø‡¶¨‡¶∞‡¶£</th><th>‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£</th><th>‡¶¶‡¶∞</th><th>‡¶ü‡¶æ‡¶ï‡¶æ</th><th>‡¶Æ‡ßÅ‡¶õ‡ßÅ‡¶®</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
            <button class="btn btn-add" onclick="addRow()">+ ‡¶®‡¶§‡ßÅ‡¶® ‡¶™‡¶£‡ßç‡¶Ø ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®</button>
            <div class="totals-container">
                <table class="totals-table">
                    <tbody>
                        <tr><td>‡¶Æ‡ßã‡¶ü</td><td class="text-right" id="grand-total">0.00</td></tr>
                        <tr><td>‡¶Ö‡¶ó‡ßç‡¶∞‡¶ø‡¶Æ</td><td><input type="number" id="advance" value="0" min="0" oninput="calculateTotals()" style="text-align:right; width: 120px; padding: 8px;"></td></tr>
                        <tr><td><strong>‡¶¨‡¶æ‡¶ï‡¶ø</strong></td><td class="text-right" id="due"><strong>0.00</strong></td></tr>
                    </tbody>
                </table>
            </div>
            <div class="clearfix"></div>
            <button class="btn btn-print" id="print-save-btn" onclick="saveAndShowPreview()">‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶£ ‡¶ì ‡¶™‡ßç‡¶∞‡¶ø‡¶≠‡¶ø‡¶â ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶® üìÑ</button>
        </div>
    </div>

    <div id="history-page" style="display: none;">
        <div class="container">
            <div class="header-bar">
                 <h1 id="history-page-title">‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶ø‡¶§ ‡¶Æ‡ßá‡¶Æ‡ßã‡¶∞ ‡¶§‡¶æ‡¶≤‡¶ø‡¶ï‡¶æ</h1>
            </div>
            <!-- ‡¶á‡¶§‡¶ø‡¶π‡¶æ‡¶∏ ‡¶™‡ßá‡¶ú‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶°‡ßç‡¶∞‡¶™‡¶°‡¶æ‡¶â‡¶® -->
            <div class="shop-dropdown">
                <div class="custom-dropdown" id="history-custom-dropdown">
                    <div class="custom-dropdown-select" id="history-dropdown-select">
                        <div class="custom-dropdown-selected">
                            <span id="selected-history-shop-text">‡¶∏‡¶ï‡¶≤ ‡¶¶‡ßã‡¶ï‡¶æ‡¶®</span>
                        </div>
                        <svg class="custom-dropdown-chevron" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <polyline points="6 9 12 15 18 9"></polyline>
                        </svg>
                    </div>
                    <div class="custom-dropdown-options" id="history-dropdown-options">
                        <!-- Options will be populated dynamically -->
                    </div>
                </div>
            </div>
            <ul id="history-list"></ul>
        </div>
        <button class="fab-add" id="fab-add-memo">+</button>
    </div>

    <!-- === ‡¶¶‡ßã‡¶ï‡¶æ‡¶® ‡¶¨‡ßç‡¶Ø‡¶¨‡¶∏‡ßç‡¶•‡¶æ‡¶™‡¶®‡¶æ ‡¶™‡ßá‡¶ú === -->
    <div id="shop-page" style="display: none;">
        <div class="container">
            <div class="header-bar">
                <h1>‡¶¶‡ßã‡¶ï‡¶æ‡¶® ‡¶¨‡ßç‡¶Ø‡¶¨‡¶∏‡ßç‡¶•‡¶æ‡¶™‡¶®‡¶æ</h1>
            </div>
            
            <div class="shop-management-section">
                <div class="shop-management-header">
                    <h2 class="shop-management-title">‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶¶‡ßã‡¶ï‡¶æ‡¶®‡¶∏‡¶Æ‡ßÇ‡¶π</h2>
                    <button class="btn btn-add" onclick="openAddShopModal()">+ ‡¶®‡¶§‡ßÅ‡¶® ‡¶¶‡ßã‡¶ï‡¶æ‡¶®</button>
                </div>
                
                <div id="shop-list-container" class="shop-list">
                    <!-- ‡¶¶‡ßã‡¶ï‡¶æ‡¶®‡ßá‡¶∞ ‡¶§‡¶æ‡¶≤‡¶ø‡¶ï‡¶æ ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶≤‡ßã‡¶° ‡¶π‡¶¨‡ßá -->
                </div>
            </div>
        </div>
    </div>
    
    <div class="bottom-nav">
        <a href="#" class="nav-item active" id="bottom-nav-home">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path><polyline points="9 22 9 12 15 12 15 22"></polyline></svg>
            <span>‡¶π‡ßã‡¶Æ</span>
        </a>
        <a href="#" class="nav-item" id="bottom-nav-memo">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10 9 9 9 8 9"></polyline></svg>
            <span>‡¶Æ‡ßá‡¶Æ‡ßã</span>
        </a>
        <a href="#" class="nav-item" id="bottom-nav-history">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10 9 9 9 8 9"></polyline></svg>
            <span>‡¶≤‡¶ø‡¶∏‡ßç‡¶ü</span>
        </a>
        <a href="#" class="nav-item" id="bottom-nav-shop">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z"></path><line x1="3" y1="6" x2="21" y2="6"></line><path d="M16 10a4 4 0 0 1-8 0"></path></svg>
            <span>‡¶¶‡ßã‡¶ï‡¶æ‡¶®</span>
        </a>
    </div>

    <!-- Modals -->
    <div id="shopEditModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="shop-modal-title">‡¶¶‡ßã‡¶ï‡¶æ‡¶®‡ßá‡¶∞ ‡¶§‡¶•‡ßç‡¶Ø ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®</h2>
                <span class="modal-close-btn" id="shop-edit-modal-close-btn">&times;</span>
            </div>
            <div class="modal-body">
                <div class="shop-edit-form">
                    <label for="shop-name-input">‡¶¶‡ßã‡¶ï‡¶æ‡¶®‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ</label>
                    <input type="text" id="shop-name-input" placeholder="‡¶Ü‡¶¨‡ßç‡¶¶‡ßÅ‡¶≤‡ßç‡¶≤‡¶æ‡¶π ‡¶á‡¶≤‡ßá‡¶ï‡¶ü‡ßç‡¶∞‡¶ø‡¶ï ‡¶è‡¶®‡ßç‡¶° ‡¶á‡¶≤‡ßá‡¶ï‡¶ü‡ßç‡¶∞‡¶®‡¶ø‡¶ï‡ßç‡¶∏">
                    <label for="proprietor-name-input">‡¶™‡ßç‡¶∞‡ßã‡¶É ‡¶®‡¶æ‡¶Æ</label>
                    <input type="text" id="proprietor-name-input" placeholder="‡¶Æ‡ßã‡¶É ‡¶Ü‡¶¨‡ßç‡¶¶‡ßÅ‡¶≤‡ßç‡¶≤‡¶æ‡¶π ‡¶Æ‡ßã‡¶≤‡ßç‡¶≤‡¶æ">
                    <label for="shop-details1-input">‡¶¶‡ßã‡¶ï‡¶æ‡¶®‡ßá‡¶∞ ‡¶¨‡¶ø‡¶¨‡¶∞‡¶£</label>
                    <input type="text" id="shop-details1-input" placeholder="‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶∏‡¶ï‡¶≤ ‡¶™‡ßç‡¶∞‡¶ï‡¶æ‡¶∞ ‡¶á‡¶≤‡ßá‡¶ï‡¶ü‡ßç‡¶∞‡¶®‡¶ø‡¶ï ‡¶ì ‡¶á‡¶≤‡ßá‡¶ï‡¶ü‡ßç‡¶∞‡¶®‡¶ø‡¶ï‡ßç‡¶∏ ‡¶Ü‡¶á‡¶ü‡ßá‡¶Æ...">
                    <label for="shop-contact-input">‡¶Ø‡ßã‡¶ó‡¶æ‡¶Ø‡ßã‡¶ó</label>
                    <input type="text" id="shop-contact-input" placeholder="‡¶Ø‡ßã‡¶ó‡¶æ‡¶Ø‡ßã‡¶ó: ‡ß¶‡ßß‡ß©‡ß®‡ß¨-‡ßß‡ß≠‡ß¶‡ß≠‡ß≠‡ß≠">
                    <label for="shop-logo-input">‡¶≤‡ßã‡¶ó‡ßã URL</label>
                    <input type="text" id="shop-logo-input" placeholder="https://i.ibb.co/...">
                    <button class="btn btn-add" id="save-shop-info-btn" style="width: 100%; margin-top: 20px;">‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶£ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
                </div>
            </div>
        </div>
    </div>

    <div id="privacyModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>‡¶ó‡ßã‡¶™‡¶®‡ßÄ‡¶Ø‡¶º‡¶§‡¶æ ‡¶®‡ßÄ‡¶§‡¶ø (Privacy Policy)</h2>
                <span class="modal-close-btn" id="privacy-modal-close-btn">&times;</span>
            </div>
            <div class="modal-body">
                <p>‡¶Ü‡¶Æ‡¶∞‡¶æ ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶§‡¶•‡ßç‡¶Ø‡ßá‡¶∞ ‡¶ó‡ßã‡¶™‡¶®‡ßÄ‡¶Ø‡¶º‡¶§‡¶æ‡¶ï‡ßá ‡¶∏‡¶Æ‡ßç‡¶Æ‡¶æ‡¶® ‡¶ï‡¶∞‡¶ø‡•§ ‡¶è‡¶á ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™‡¶ü‡¶ø ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶∏‡¶Æ‡¶Ø‡¶º ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶™‡ßç‡¶∞‡¶¶‡¶æ‡¶® ‡¶ï‡¶∞‡¶æ ‡¶∏‡¶ï‡¶≤ ‡¶§‡¶•‡ßç‡¶Ø ‡¶∏‡ßÅ‡¶∞‡¶ï‡ßç‡¶∑‡¶ø‡¶§ ‡¶∞‡¶æ‡¶ñ‡¶æ ‡¶Ü‡¶Æ‡¶æ‡¶¶‡ßá‡¶∞ ‡¶¶‡¶æ‡ßü‡¶ø‡¶§‡ßç‡¶¨‡•§</p>
                <h3>‡¶ï‡ßã‡¶® ‡¶§‡¶•‡ßç‡¶Ø ‡¶∏‡¶Ç‡¶ó‡ßç‡¶∞‡¶π ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º?</h3>
                <p>‡¶è‡¶á ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™‡¶ü‡¶ø ‡¶∂‡ßÅ‡¶ß‡ßÅ‡¶Æ‡¶æ‡¶§‡ßç‡¶∞ ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶§‡ßà‡¶∞‡¶ø ‡¶ï‡¶∞‡¶æ ‡¶¨‡¶ø‡¶≤‡ßá‡¶∞ ‡¶§‡¶•‡ßç‡¶Ø ‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶£ ‡¶ï‡¶∞‡ßá, ‡¶Ø‡¶æ‡¶∞ ‡¶Æ‡¶ß‡ßç‡¶Ø‡ßá ‡¶Ö‡¶®‡ßç‡¶§‡¶∞‡ßç‡¶≠‡ßÅ‡¶ï‡ßç‡¶§ ‡¶•‡¶æ‡¶ï‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßá:</p>
                <ul>
                    <li>‡¶Æ‡ßá‡¶Æ‡ßã ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞, ‡¶ï‡ßç‡¶∞‡ßá‡¶§‡¶æ‡¶∞ ‡¶®‡¶æ‡¶Æ ‡¶è‡¶¨‡¶Ç ‡¶†‡¶ø‡¶ï‡¶æ‡¶®‡¶æ‡•§</li>
                    <li>‡¶≤‡ßá‡¶®‡¶¶‡ßá‡¶®‡ßá‡¶∞ ‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ ‡¶è‡¶¨‡¶Ç ‡¶°‡ßá‡¶≤‡¶ø‡¶≠‡¶æ‡¶∞‡¶ø‡¶∞ ‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ‡•§</li>
                    <li>‡¶™‡¶£‡ßç‡¶Ø‡ßá‡¶∞ ‡¶¨‡¶ø‡¶¨‡¶∞‡¶£, ‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£, ‡¶¶‡¶∞ ‡¶è‡¶¨‡¶Ç ‡¶Æ‡ßã‡¶ü ‡¶ü‡¶æ‡¶ï‡¶æ‡¶∞ ‡¶π‡¶ø‡¶∏‡¶æ‡¶¨‡•§</li>
                </ul>
                <h3>‡¶ï‡ßÄ‡¶≠‡¶æ‡¶¨‡ßá ‡¶§‡¶•‡ßç‡¶Ø ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º?</h3>
                <p>‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶ø‡¶§ ‡¶¨‡¶ø‡¶≤‡ßá‡¶∞ ‡¶§‡¶•‡ßç‡¶Ø ‡¶∂‡ßÅ‡¶ß‡ßÅ‡¶Æ‡¶æ‡¶§‡ßç‡¶∞ ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶¨‡ßç‡¶Ø‡¶¨‡¶∏‡¶æ‡ßü‡¶ø‡¶ï ‡¶π‡¶ø‡¶∏‡¶æ‡¶¨ ‡¶¨‡ßç‡¶Ø‡¶¨‡¶∏‡ßç‡¶•‡¶æ‡¶™‡¶®‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡•§ ‡¶è‡¶á ‡¶§‡¶•‡ßç‡¶Ø ‡¶Ö‡¶®‡ßç‡¶Ø ‡¶ï‡ßã‡¶®‡ßã ‡¶¨‡ßç‡¶Ø‡¶ï‡ßç‡¶§‡¶ø ‡¶¨‡¶æ ‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶∑‡ßç‡¶†‡¶æ‡¶®‡ßá‡¶∞ ‡¶∏‡¶æ‡¶•‡ßá ‡¶∂‡ßá‡ßü‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü ‡¶®‡¶æ‡•§ ‡¶∏‡¶ï‡¶≤ ‡¶§‡¶•‡ßç‡¶Ø Google Firebase-‡¶è‡¶∞ ‡¶∏‡ßÅ‡¶∞‡¶ï‡ßç‡¶∑‡¶ø‡¶§ ‡¶°‡¶æ‡¶ü‡¶æ‡¶¨‡ßá‡¶∏‡ßá ‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶£ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º, ‡¶Ø‡¶æ ‡¶∂‡ßÅ‡¶ß‡ßÅ‡¶Æ‡¶æ‡¶§‡ßç‡¶∞ ‡¶Ü‡¶™‡¶®‡¶ø‡¶á ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡ßç‡¶∏‡ßá‡¶∏ ‡¶ï‡¶∞‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßá‡¶®‡•§</p>
                <p>‡¶Ü‡¶Æ‡¶∞‡¶æ ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶§‡¶•‡ßç‡¶Ø‡ßá‡¶∞ ‡¶®‡¶ø‡¶∞‡¶æ‡¶™‡¶§‡ßç‡¶§‡¶æ ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§ ‡¶ï‡¶∞‡¶§‡ßá ‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶∂‡ßç‡¶∞‡ßÅ‡¶§‡¶ø‡¶¨‡¶¶‡ßç‡¶ß‡•§</p>
            </div>
        </div>
    </div>

    <script>
        // --- Firebase Configuration ---
        const firebaseConfig = {
            apiKey: "AIzaSyAUjV_tUlWb5S7A8HSoTcU3vjvbuPzjtvI",
            authDomain: "app-1-e0ede.firebaseapp.com",
            databaseURL: "https://app-1-e0ede-default-rtdb.firebaseio.com",
            projectId: "app-1-e0ede",
            storageBucket: "app-1-e0ede.firebasestorage.app",
            messagingSenderId: "679519684721",
            appId: "1:679519684721:web:56b78c83b7fc66c30c73d0"
        };
        
        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        
        // Global variables
        let currentlyEditing = null;
        let selectedShopId = null;
        let shops = {};
        let currentSlide = 0;
        let slideInterval;

        // --- ‡¶®‡ßç‡¶Ø‡¶æ‡¶≠‡¶ø‡¶ó‡ßá‡¶∂‡¶® ‡¶¨‡¶æ‡¶∞ ‡¶Ö‡¶ü‡ßã-‡¶π‡¶æ‡¶á‡¶° ‡¶´‡¶æ‡¶Ç‡¶∂‡¶® ---
        let lastScrollTop = 0;
        const navbar = document.getElementById('navbar');
        const bottomNav = document.querySelector('.bottom-nav'); // ‡¶®‡¶§‡ßÅ‡¶® ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶®
        const scrollThreshold = 100; // ‡¶ï‡¶§ ‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶≤ ‡¶ï‡¶∞‡¶≤‡ßá ‡¶π‡¶æ‡¶á‡¶° ‡¶π‡¶¨‡ßá

        function handleNavbarScroll() {
            const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
            
            if (scrollTop > lastScrollTop && scrollTop > scrollThreshold) {
                navbar.classList.add('hidden');
                if (bottomNav) bottomNav.classList.add('hidden'); // ‡¶®‡¶§‡ßÅ‡¶® ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶®
            } else {
                navbar.classList.remove('hidden');
                if (bottomNav) bottomNav.classList.remove('hidden'); // ‡¶®‡¶§‡ßÅ‡¶® ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶®
            }
            
            lastScrollTop = scrollTop;
        }

        window.addEventListener('scroll', handleNavbarScroll);

        let touchStartY = 0;
        let touchEndY = 0;

        document.addEventListener('touchstart', e => {
            touchStartY = e.changedTouches[0].screenY;
        });

        document.addEventListener('touchend', e => {
            touchEndY = e.changedTouches[0].screenY;
            handleTouchScroll();
        });

        function handleTouchScroll() {
            if (touchStartY - touchEndY > 50) { // Scrolling down
                navbar.classList.add('hidden');
                if (bottomNav) bottomNav.classList.add('hidden'); // ‡¶®‡¶§‡ßÅ‡¶® ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶®
            } else if (touchEndY - touchStartY > 50) { // Scrolling up
                navbar.classList.remove('hidden');
                if (bottomNav) bottomNav.classList.remove('hidden'); // ‡¶®‡¶§‡ßÅ‡¶® ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶®
            }
        }

        window.addEventListener('load', () => {
            navbar.classList.remove('hidden');
            if (bottomNav) bottomNav.classList.remove('hidden'); // ‡¶®‡¶§‡ßÅ‡¶® ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶®
        });

        document.addEventListener('visibilitychange', () => {
            if (!document.hidden) {
                navbar.classList.remove('hidden');
                if (bottomNav) bottomNav.classList.remove('hidden'); // ‡¶®‡¶§‡ßÅ‡¶® ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶®
            }
        });

        // --- Page Navigation & UI ---
        const mainContent = document.getElementById('main-content');
        const historyPage = document.getElementById('history-page');
        const shopPage = document.getElementById('shop-page');
        const homePage = document.getElementById('home-page');
        const previewPage = document.getElementById('preview-page'); // ‡¶®‡¶§‡ßÅ‡¶® ‡¶™‡ßç‡¶∞‡¶ø‡¶≠‡¶ø‡¶â ‡¶™‡ßá‡¶ú
        const fabAddMemo = document.getElementById('fab-add-memo');

        function showHomeDashboard() {
            homePage.style.display = 'block';
            mainContent.style.display = 'none';
            historyPage.style.display = 'none';
            shopPage.style.display = 'none';
            previewPage.style.display = 'none'; // ‡¶™‡ßç‡¶∞‡¶ø‡¶≠‡¶ø‡¶â ‡¶™‡ßá‡¶ú ‡¶π‡¶æ‡¶á‡¶° ‡¶ï‡¶∞‡ßÅ‡¶®
            handleActiveNav('bottom-nav-home');
            loadHomeStats();
            startSlider();
        }
        
        function showMemoPage() {
            homePage.style.display = 'none';
            mainContent.style.display = 'block';
            historyPage.style.display = 'none';
            shopPage.style.display = 'none';
            previewPage.style.display = 'none'; // ‡¶™‡ßç‡¶∞‡¶ø‡¶≠‡¶ø‡¶â ‡¶™‡ßá‡¶ú ‡¶π‡¶æ‡¶á‡¶° ‡¶ï‡¶∞‡ßÅ‡¶®
            handleActiveNav('bottom-nav-memo');
            stopSlider();
        }
        
        function showHistoryPage(showFabButton = true) {
            homePage.style.display = 'none';
            mainContent.style.display = 'none';
            historyPage.style.display = 'block';
            shopPage.style.display = 'none';
            previewPage.style.display = 'none'; // ‡¶™‡ßç‡¶∞‡¶ø‡¶≠‡¶ø‡¶â ‡¶™‡ßá‡¶ú ‡¶π‡¶æ‡¶á‡¶° ‡¶ï‡¶∞‡ßÅ‡¶®
            if (fabAddMemo) {
                fabAddMemo.style.display = showFabButton ? 'block' : 'none';
            }
            historyView = 'dates';
            selectedHistoryDate = null;
            displayHistory();
            handleActiveNav('bottom-nav-history');
            stopSlider();
        }
        
        function showShopPage() {
            homePage.style.display = 'none';
            mainContent.style.display = 'none';
            historyPage.style.display = 'none';
            shopPage.style.display = 'block';
            previewPage.style.display = 'none'; // ‡¶™‡ßç‡¶∞‡¶ø‡¶≠‡¶ø‡¶â ‡¶™‡ßá‡¶ú ‡¶π‡¶æ‡¶á‡¶° ‡¶ï‡¶∞‡ßÅ‡¶®
            handleActiveNav('bottom-nav-shop');
            loadShopList();
            stopSlider();
        }

        function handleActiveNav(activeId){
            document.querySelectorAll('.nav-item').forEach(item=>{
                item.classList.remove('active');
            });
            if(document.getElementById(activeId)){
                document.getElementById(activeId).classList.add('active');
            }
        }

        // --- SIDENAV FUNCTIONS ---
        function openNav() {
            document.getElementById("mySidenav").style.width = "280px";
            // navbar ‡¶è‡¶ñ‡¶® ‡¶Ü‡¶∞ ‡¶¨‡ßç‡¶≤‡¶æ‡¶∞ ‡¶π‡¶¨‡ßá ‡¶®‡¶æ
            const contentToBlur = document.querySelectorAll('#main-content, #history-page, #shop-page, #home-page, #preview-page, .bottom-nav, .fab-add');
            contentToBlur.forEach(el => {
                if (el) el.classList.add('content-blur');
            });
        }

        function closeNav() {
            document.getElementById("mySidenav").style.width = "0";
            // navbar ‡¶è‡¶ñ‡¶® ‡¶Ü‡¶∞ ‡¶¨‡ßç‡¶≤‡¶æ‡¶∞ ‡¶π‡¶¨‡ßá ‡¶®‡¶æ
            const contentToBlur = document.querySelectorAll('#main-content, #history-page, #shop-page, #home-page, #preview-page, .bottom-nav, .fab-add');
            contentToBlur.forEach(el => {
                if (el) el.classList.remove('content-blur');
            });
        }

        // --- 16:9 ‡¶∏‡ßç‡¶≤‡¶æ‡¶á‡¶°‡¶æ‡¶∞ ‡¶´‡¶æ‡¶Ç‡¶∂‡¶® ---
        function initSlider() {
            const slides = document.querySelectorAll('.slide');
            const navContainer = document.getElementById('slider-nav');
            
            if (!navContainer) return;
            
            navContainer.innerHTML = '';
            slides.forEach((_, index) => {
                const dot = document.createElement('div');
                dot.className = `nav-dot ${index === 0 ? 'active' : ''}`;
                dot.onclick = () => goToSlide(index);
                navContainer.appendChild(dot);
            });
            
            updateSlider();
        }

        function startSlider() {
            stopSlider();
            slideInterval = setInterval(() => {
                nextSlide();
            }, 5000);
        }

        function stopSlider() {
            if (slideInterval) {
                clearInterval(slideInterval);
                slideInterval = null;
            }
        }

        function nextSlide() {
            const slides = document.querySelectorAll('.slide');
            if (slides.length === 0) return;
            
            currentSlide = (currentSlide + 1) % slides.length;
            updateSlider();
        }

        function prevSlide() {
            const slides = document.querySelectorAll('.slide');
            if (slides.length === 0) return;
            
            currentSlide = (currentSlide - 1 + slides.length) % slides.length;
            updateSlider();
        }

        function goToSlide(index) {
            const slides = document.querySelectorAll('.slide');
            if (slides.length === 0) return;
            
            currentSlide = index;
            updateSlider();
        }

        function updateSlider() {
            const slides = document.getElementById('slides');
            const dots = document.querySelectorAll('.nav-dot');
            
            if (!slides) return;
            
            const slideWidth = 100;
            slides.style.transform = `translateX(-${currentSlide * slideWidth}%)`;
            
            dots.forEach((dot, index) => {
                dot.classList.toggle('active', index === currentSlide);
            });
        }

        // --- ‡¶π‡ßã‡¶Æ ‡¶™‡ßá‡¶ú ‡¶´‡¶æ‡¶Ç‡¶∂‡¶® ---
        function loadHomeStats() {
            const statsContainer = document.getElementById('home-stats');
            if (!statsContainer) return;
            
            const memosRef = database.ref('memos');
            memosRef.once('value').then((snapshot) => {
                let totalMemos = 0;
                let totalRevenue = 0;
                let todayMemos = 0;
                
                const today = new Date().toISOString().split('T')[0];
                
                if (snapshot.exists()) {
                    snapshot.forEach((dateSnapshot) => {
                        const memosOnDate = dateSnapshot.val();
                        const memoCount = Object.keys(memosOnDate).length;
                        totalMemos += memoCount;
                        
                        if (dateSnapshot.key === today) {
                            todayMemos = memoCount;
                        }
                        
                        for (const key in memosOnDate) {
                            const memo = memosOnDate[key];
                            totalRevenue += parseFloat(memo.grandTotal || 0);
                        }
                    });
                }
                
                statsContainer.innerHTML = `
                    <div class="stat-card">
                        <div class="stat-number">${totalMemos}</div>
                        <div class="stat-label">‡¶Æ‡ßã‡¶ü ‡¶Æ‡ßá‡¶Æ‡ßã</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">${todayMemos}</div>
                        <div class="stat-label">‡¶Ü‡¶ú‡¶ï‡ßá‡¶∞ ‡¶Æ‡ßá‡¶Æ‡ßã</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">‡ß≥${totalRevenue.toFixed(2)}</div>
                        <div class="stat-label">‡¶Æ‡ßã‡¶ü ‡¶¨‡¶ø‡¶ï‡ßç‡¶∞‡¶Ø‡¶º</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">${Object.keys(shops).length}</div>
                        <div class="stat-label">‡¶¶‡ßã‡¶ï‡¶æ‡¶® ‡¶∏‡¶Ç‡¶ñ‡ßç‡¶Ø‡¶æ</div>
                    </div>
                `;
            }).catch(error => {
                console.error("Error loading stats:", error);
                statsContainer.innerHTML = `
                    <div class="stat-card"><div class="stat-number">0</div><div class="stat-label">‡¶Æ‡ßã‡¶ü ‡¶Æ‡ßá‡¶Æ‡ßã</div></div>
                    <div class="stat-card"><div class="stat-number">0</div><div class="stat-label">‡¶Ü‡¶ú‡¶ï‡ßá‡¶∞ ‡¶Æ‡ßá‡¶Æ‡ßã</div></div>
                    <div class="stat-card"><div class="stat-number">‡ß≥0.00</div><div class="stat-label">‡¶Æ‡ßã‡¶ü ‡¶¨‡¶ø‡¶ï‡ßç‡¶∞‡¶Ø‡¶º</div></div>
                    <div class="stat-card"><div class="stat-number">${Object.keys(shops).length}</div><div class="stat-label">‡¶¶‡ßã‡¶ï‡¶æ‡¶® ‡¶∏‡¶Ç‡¶ñ‡ßç‡¶Ø‡¶æ</div></div>
                `;
            });
        }

        // --- Custom Dropdown Functions ---
        function initializeCustomDropdowns() {
            const shopDropdown = document.getElementById('shop-custom-dropdown');
            const shopDropdownSelect = document.getElementById('shop-dropdown-select');
            const shopDropdownOptions = document.getElementById('shop-dropdown-options');
            
            const historyDropdown = document.getElementById('history-custom-dropdown');
            const historyDropdownSelect = document.getElementById('history-dropdown-select');
            const historyDropdownOptions = document.getElementById('history-dropdown-options');
            
            if (shopDropdownSelect && shopDropdownOptions) {
                shopDropdownSelect.addEventListener('click', function(e) {
                    e.stopPropagation();
                    shopDropdown.classList.toggle('selected');
                    if (historyDropdown) historyDropdown.classList.remove('selected');
                });
                
                shopDropdownOptions.addEventListener('click', function(e) {
                    e.stopPropagation();
                });
            }
            
            if (historyDropdownSelect && historyDropdownOptions) {
                historyDropdownSelect.addEventListener('click', function(e) {
                    e.stopPropagation();
                    historyDropdown.classList.toggle('selected');
                    if (shopDropdown) shopDropdown.classList.remove('selected');
                });
                
                historyDropdownOptions.addEventListener('click', function(e) {
                    e.stopPropagation();
                });
            }
            
            document.addEventListener('click', function() {
                if (shopDropdown) shopDropdown.classList.remove('selected');
                if (historyDropdown) historyDropdown.classList.remove('selected');
            });
        }
        
        // --- Shop Management Functions ---
        function fetchShops() {
            const shopsRef = database.ref('shops');
            shopsRef.on('value', (snapshot) => {
                if (snapshot.exists()) {
                    shops = snapshot.val();
                    updateCustomDropdowns();
                    
                    if (!selectedShopId && Object.keys(shops).length > 0) {
                        selectedShopId = Object.keys(shops)[0];
                        updateUIWithShopInfo();
                    }
                } else {
                    createDefaultShop();
                }
            }, (error) => {
                console.error("Error fetching shops:", error);
            });
        }

        function createDefaultShop() {
            const defaultShop = {
                name: "‡¶Ö‡¶®‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶Ø ‡¶¶‡ßã‡¶ï‡¶æ‡¶®",
                proprietor: "‡¶™‡ßç‡¶∞‡ßã‡¶É",
                details1: "‡¶¨‡¶ø‡¶¨‡¶∞‡¶£ ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®",
                contact: "‡¶Ø‡ßã‡¶ó‡¶æ‡¶Ø‡ßã‡¶ó‡¶É",
                logoUrl: "https://i.ibb.co/fYwdd8h/IMG-20251107-WA0006.jpg"
            };
            
            const newShopRef = database.ref('shops').push();
            newShopRef.set(defaultShop)
                .then(() => {
                    selectedShopId = newShopRef.key;
                    updateCustomDropdowns();
                })
                .catch(error => {
                    console.error("Error creating default shop:", error);
                });
        }

        function updateCustomDropdowns() {
            updateMainDropdown();
            updateHistoryDropdown();
            updateUIWithShopInfo();
        }

        function updateMainDropdown() {
            const dropdownOptions = document.getElementById('shop-dropdown-options');
            const selectedText = document.getElementById('selected-shop-text');
            
            if (!dropdownOptions || !selectedText) return;
            
            dropdownOptions.innerHTML = '';
            
            const defaultOption = document.createElement('div');
            defaultOption.className = 'custom-dropdown-option';
            defaultOption.innerHTML = `<div class="custom-dropdown-option-text"><div class="custom-dropdown-option-name">‡¶¶‡ßã‡¶ï‡¶æ‡¶® ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®...</div></div>`;
            defaultOption.onclick = () => {
                selectedShopId = null;
                selectedText.textContent = '‡¶¶‡ßã‡¶ï‡¶æ‡¶® ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®...';
                const shopDropdown = document.getElementById('shop-custom-dropdown');
                if (shopDropdown) shopDropdown.classList.remove('selected');
                updateUIWithShopInfo();
            };
            dropdownOptions.appendChild(defaultOption);
            
            for (const shopId in shops) {
                const shop = shops[shopId];
                const option = document.createElement('div');
                option.className = `custom-dropdown-option ${selectedShopId === shopId ? 'selected' : ''}`;
                option.innerHTML = `
                    <img src="${shop.logoUrl}" alt="${shop.name}" class="custom-dropdown-option-logo" onerror="this.src='https://i.ibb.co/fYwdd8h/IMG-20251107-WA0006.jpg'">
                    <div class="custom-dropdown-option-text">
                        <div class="custom-dropdown-option-name">${shop.name}</div>
                        <div class="custom-dropdown-option-contact">${shop.contact}</div>
                    </div>
                `;
                option.onclick = () => {
                    selectedShopId = shopId;
                    selectedText.textContent = shop.name;
                    const shopDropdown = document.getElementById('shop-custom-dropdown');
                    if (shopDropdown) shopDropdown.classList.remove('selected');
                    updateUIWithShopInfo();
                };
                dropdownOptions.appendChild(option);
                
                if (selectedShopId === shopId) {
                    selectedText.textContent = shop.name;
                }
            }
        }

        function updateHistoryDropdown() {
            const dropdownOptions = document.getElementById('history-dropdown-options');
            const selectedText = document.getElementById('selected-history-shop-text');
            
            if (!dropdownOptions || !selectedText) return;
            
            dropdownOptions.innerHTML = '';
            
            const allOption = document.createElement('div');
            allOption.className = `custom-dropdown-option ${!selectedShopId ? 'selected' : ''}`;
            allOption.innerHTML = `<div class="custom-dropdown-option-text"><div class="custom-dropdown-option-name">‡¶∏‡¶ï‡¶≤ ‡¶¶‡ßã‡¶ï‡¶æ‡¶®</div></div>`;
            allOption.onclick = () => {
                selectedShopId = null;
                selectedText.textContent = '‡¶∏‡¶ï‡¶≤ ‡¶¶‡ßã‡¶ï‡¶æ‡¶®';
                const historyDropdown = document.getElementById('history-custom-dropdown');
                if (historyDropdown) historyDropdown.classList.remove('selected');
                displayHistory();
            };
            dropdownOptions.appendChild(allOption);
            
            for (const shopId in shops) {
                const shop = shops[shopId];
                const option = document.createElement('div');
                option.className = `custom-dropdown-option ${selectedShopId === shopId ? 'selected' : ''}`;
                option.innerHTML = `
                    <img src="${shop.logoUrl}" alt="${shop.name}" class="custom-dropdown-option-logo" onerror="this.src='https://i.ibb.co/fYwdd8h/IMG-20251107-WA0006.jpg'">
                    <div class="custom-dropdown-option-text">
                        <div class="custom-dropdown-option-name">${shop.name}</div>
                        <div class="custom-dropdown-option-contact">${shop.contact}</div>
                    </div>
                `;
                option.onclick = () => {
                    selectedShopId = shopId;
                    selectedText.textContent = shop.name;
                    const historyDropdown = document.getElementById('history-custom-dropdown');
                    if (historyDropdown) historyDropdown.classList.remove('selected');
                    displayHistory();
                };
                dropdownOptions.appendChild(option);
                
                if (selectedShopId === shopId) {
                    selectedText.textContent = shop.name;
                }
            }
        }

        function updateUIWithShopInfo() {
            const headerLogo = document.getElementById('main-header-logo');
            const headerTitle = document.getElementById('main-header-title');
            
            if (headerLogo && headerTitle) {
                if (selectedShopId && shops[selectedShopId]) {
                    const shop = shops[selectedShopId];
                    headerLogo.src = shop.logoUrl;
                    headerTitle.innerText = shop.name;
                } else {
                    // ‡¶Ø‡¶ñ‡¶® ‡¶ï‡ßã‡¶®‡ßã ‡¶¶‡ßã‡¶ï‡¶æ‡¶® ‡¶∏‡¶ø‡¶≤‡ßá‡¶ï‡ßç‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶•‡¶æ‡¶ï‡¶¨‡ßá ‡¶®‡¶æ, ‡¶°‡¶ø‡¶´‡¶≤‡ßç‡¶ü ‡¶¶‡ßá‡¶ñ‡¶æ‡¶¨‡ßá
                    headerLogo.src = "https://i.ibb.co/fYwdd8h/IMG-20251107-WA0006.jpg";
                    headerTitle.innerText = "‡¶¨‡¶ø‡¶≤ ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶ú‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶∏‡¶ø‡¶∏‡ßç‡¶ü‡ßá‡¶Æ";
                }
            }
        }

        function loadShopList() {
            const shopListContainer = document.getElementById('shop-list-container');
            if (!shopListContainer) return;
            
            if (Object.keys(shops).length === 0) {
                shopListContainer.innerHTML = `
                    <div class="empty-state-container">
                        <div class="empty-state-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z"></path><line x1="3" y1="6" x2="21" y2="6"></line><path d="M16 10a4 4 0 0 1-8 0"></path></svg>
                        </div>
                        <h2 class="empty-state-title">‡¶ï‡ßã‡¶® ‡¶¶‡ßã‡¶ï‡¶æ‡¶® ‡¶®‡ßá‡¶á</h2>
                        <p class="empty-state-subtitle">‡¶®‡¶§‡ßÅ‡¶® ‡¶¶‡ßã‡¶ï‡¶æ‡¶® ‡¶§‡ßà‡¶∞‡¶ø ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶ï‡¶∞‡ßÅ‡¶®</p>
                    </div>
                `;
                return;
            }
            
            shopListContainer.innerHTML = '';
            
            for (const shopId in shops) {
                const shop = shops[shopId];
                const shopItem = document.createElement('div');
                shopItem.className = 'shop-item';
                shopItem.innerHTML = `
                    <img src="${shop.logoUrl}" alt="${shop.name}" class="shop-item-logo" onerror="this.src='https://i.ibb.co/fYwdd8h/IMG-20251107-WA0006.jpg'">
                    <div class="shop-item-info">
                        <h3 class="shop-item-name">${shop.name}</h3>
                        <p class="shop-item-details">${shop.proprietor}</p>
                        <p class="shop-item-details">${shop.contact}</p>
                    </div>
                    <div class="shop-item-actions">
                        <button class="shop-item-action-btn shop-item-edit" onclick="editShop('${shopId}')">‡¶∏‡¶Æ‡ßç‡¶™‡¶æ‡¶¶‡¶®‡¶æ</button>
                        <button class="shop-item-action-btn shop-item-delete" onclick="deleteShop('${shopId}')">‡¶Æ‡ßÅ‡¶õ‡ßÅ‡¶®</button>
                    </div>
                `;
                shopListContainer.appendChild(shopItem);
            }
        }

        function openAddShopModal() {
            document.getElementById('shop-modal-title').textContent = '‡¶®‡¶§‡ßÅ‡¶® ‡¶¶‡ßã‡¶ï‡¶æ‡¶® ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®';
            document.getElementById('shop-name-input').value = '';
            document.getElementById('proprietor-name-input').value = '';
            document.getElementById('shop-details1-input').value = '';
            document.getElementById('shop-contact-input').value = '';
            document.getElementById('shop-logo-input').value = '';
            document.getElementById('save-shop-info-btn').removeAttribute('data-shop-id');
            document.getElementById('shopEditModal').style.display = 'block';
        }

        function editShop(shopId) {
            const shop = shops[shopId];
            document.getElementById('shop-modal-title').textContent = '‡¶¶‡ßã‡¶ï‡¶æ‡¶® ‡¶∏‡¶Æ‡ßç‡¶™‡¶æ‡¶¶‡¶®‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®';
            document.getElementById('shop-name-input').value = shop.name || '';
            document.getElementById('proprietor-name-input').value = shop.proprietor || '';
            document.getElementById('shop-details1-input').value = shop.details1 || '';
            document.getElementById('shop-contact-input').value = shop.contact || '';
            document.getElementById('shop-logo-input').value = shop.logoUrl || '';
            
            document.getElementById('save-shop-info-btn').setAttribute('data-shop-id', shopId);
            document.getElementById('shopEditModal').style.display = 'block';
        }

        function deleteShop(shopId) {
            if (confirm('‡¶Ü‡¶™‡¶®‡¶ø ‡¶ï‡¶ø ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§‡¶≠‡¶æ‡¶¨‡ßá ‡¶è‡¶á ‡¶¶‡ßã‡¶ï‡¶æ‡¶®‡¶ü‡¶ø ‡¶Æ‡ßÅ‡¶õ‡¶§‡ßá ‡¶ö‡¶æ‡¶®? ‡¶è‡¶á ‡¶¶‡ßã‡¶ï‡¶æ‡¶®‡ßá‡¶∞ ‡¶∏‡¶ï‡¶≤ ‡¶Æ‡ßá‡¶Æ‡ßã‡¶ì ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶Ø‡¶æ‡¶¨‡ßá‡•§')) {
                const memosRef = database.ref('memos');
                memosRef.once('value').then((snapshot) => {
                    const updates = {};
                    
                    if (snapshot.exists()) {
                        snapshot.forEach((dateSnapshot) => {
                            dateSnapshot.forEach((memoSnapshot) => {
                                const memo = memoSnapshot.val();
                                if (memo.shopId === shopId) {
                                    updates[`memos/${dateSnapshot.key}/${memoSnapshot.key}`] = null;
                                }
                            });
                        });
                    }
                    
                    updates[`shops/${shopId}`] = null;
                    
                    return database.ref().update(updates);
                }).then(() => {
                    alert('‡¶¶‡ßã‡¶ï‡¶æ‡¶® ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá!');
                    if (selectedShopId === shopId) {
                        selectedShopId = Object.keys(shops)[0] || null;
                    }
                    loadShopList();
                }).catch((error) => {
                    console.error("Error deleting shop:", error);
                    alert('‡¶¶‡ßã‡¶ï‡¶æ‡¶® ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶æ ‡¶Ø‡¶æ‡ßü‡¶®‡¶ø‡•§');
                });
            }
        }

        // --- Bill Management Functions ---
        function updateSerialNumbers(){
            document.querySelectorAll('#bill-table tbody tr').forEach((row,index)=>{
                row.cells[0].textContent=index+1;
            });
        }
        
        function calculateRow(element){
            let row=element.closest('tr');
            let quantity=parseFloat(row.querySelector('.quantity').value)||0;
            let price=parseFloat(row.querySelector('.price').value)||0;
            row.querySelector('.amount').value=(quantity*price).toFixed(2);
            calculateTotals();
        }
        
        function calculateTotals(){
            let grandTotal=0;
            document.querySelectorAll('.amount').forEach(field=>{
                grandTotal+=parseFloat(field.value)||0;
            });
            const grandTotalElement = document.getElementById('grand-total');
            const dueElement = document.getElementById('due');
            
            if (grandTotalElement) grandTotalElement.innerText=grandTotal.toFixed(2);
            let advance=parseFloat(document.getElementById('advance').value)||0;
            if (dueElement) dueElement.innerText=(grandTotal-advance).toFixed(2);
        }
        
        function addRow(){
            let tableBody=document.querySelector('#bill-table tbody');
            if (!tableBody) return;
            
            let newRow=tableBody.insertRow();
            newRow.innerHTML=`<td></td><td><input type="text" class="product-name" placeholder="‡¶™‡¶£‡ßç‡¶Ø‡ßá‡¶∞ ‡¶¨‡¶ø‡¶¨‡¶∞‡¶£"></td><td><input type="number" class="quantity" value="1" min="1" oninput="calculateRow(this);"></td><td><input type="number" class="price" value="0" min="0" oninput="calculateRow(this);"></td><td><input type="text" class="amount" value="0.00" readonly></td><td><button class="btn btn-remove" onclick="removeRow(this)">üóëÔ∏è</button></td>`;
            updateSerialNumbers();
            const productNameInput = newRow.querySelector('.product-name');
            if (productNameInput) productNameInput.focus();
        }
        
        function removeRow(button){
            if(document.querySelectorAll('#bill-table tbody tr').length>1){
                button.closest('tr').remove();
                calculateTotals();
                updateSerialNumbers();
            }else{
                alert("‡¶∂‡ßá‡¶∑ ‡¶∏‡¶æ‡¶∞‡¶ø‡¶ü‡¶ø ‡¶Æ‡ßã‡¶õ‡¶æ ‡¶Ø‡¶æ‡¶¨‡ßá ‡¶®‡¶æ‡•§");
            }
        }
        
        function collectMemoData(){
            let items=[];
            document.querySelectorAll('#bill-table tbody tr').forEach(row=>{
                const productName = row.querySelector('.product-name');
                const quantity = row.querySelector('.quantity');
                const price = row.querySelector('.price');
                const amount = row.querySelector('.amount');
                
                if (productName && quantity && price && amount) {
                    items.push({
                        name: productName.value,
                        quantity: quantity.value,
                        price: price.value,
                        amount: amount.value
                    });
                }
            });
            
            const memoNo = document.getElementById('memo-no');
            const customerName = document.getElementById('customer-name');
            const customerAddress = document.getElementById('customer-address');
            const transactionDate = document.getElementById('transaction-date');
            const deliveryDate = document.getElementById('delivery-date');
            const advance = document.getElementById('advance');
            const grandTotal = document.getElementById('grand-total');
            const due = document.getElementById('due');
            
            return {
                memoNo: memoNo ? memoNo.value : '',
                customerName: customerName ? customerName.value : '',
                customerAddress: customerAddress ? customerAddress.value : '',
                transactionDate: transactionDate ? transactionDate.value : '',
                deliveryDate: deliveryDate ? deliveryDate.value : '',
                advance: advance ? advance.value : '0',
                items: items,
                grandTotal: grandTotal ? grandTotal.innerText : '0.00',
                due: due ? due.innerText : '0.00',
                timestamp: Date.now(),
                shopId: selectedShopId
            };
        }
        
        async function saveBillToHistory(){
            const memo=collectMemoData();
            
            if(!memo.customerName&&!memo.memoNo){
                alert('‡¶Ö‡¶®‡ßÅ‡¶ó‡ßç‡¶∞‡¶π ‡¶ï‡¶∞‡ßá ‡¶Æ‡ßá‡¶Æ‡ßã ‡¶®‡¶Ç ‡¶Ö‡¶•‡¶¨‡¶æ ‡¶ï‡ßç‡¶∞‡ßá‡¶§‡¶æ‡¶∞ ‡¶®‡¶æ‡¶Æ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®‡•§');
                return;
            }
            
            const formattedDate=memo.transactionDate;
            if(!formattedDate){
                alert('‡¶Ö‡¶®‡ßÅ‡¶ó‡ßç‡¶∞‡¶π ‡¶ï‡¶∞‡ßá ‡¶≤‡ßá‡¶®‡¶¶‡ßá‡¶®‡ßá‡¶∞ ‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®‡•§');
                return;
            }
            
            if(!memo.shopId){
                alert('‡¶Ö‡¶®‡ßÅ‡¶ó‡ßç‡¶∞‡¶π ‡¶ï‡¶∞‡ßá ‡¶è‡¶ï‡¶ü‡¶ø ‡¶¶‡ßã‡¶ï‡¶æ‡¶® ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®‡•§');
                return;
            }
            
            try{
                await database.ref('memos/'+formattedDate).push(memo);
                return true; 
            }catch(error){
                console.error("Firebase save error: ",error);
                alert('‡¶Æ‡ßá‡¶Æ‡ßã ‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶£ ‡¶ï‡¶∞‡¶æ ‡¶Ø‡¶æ‡ßü‡¶®‡¶ø‡•§');
                return false;
            }
        }
        
        async function updateBillInHistory(){
            if(!currentlyEditing) return;
            
            const memo=collectMemoData();
            const newDate=memo.transactionDate;
            if(!newDate){
                alert('‡¶Ö‡¶®‡ßÅ‡¶ó‡ßç‡¶∞‡¶π ‡¶ï‡¶∞‡ßá ‡¶≤‡ßá‡¶®‡¶¶‡ßá‡¶®‡ßá‡¶∞ ‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®‡•§');
                return;
            }
            
            const oldDate=currentlyEditing.date;
            const key=currentlyEditing.key;
            
            try{
                if(oldDate===newDate){
                    await database.ref('memos/'+oldDate+'/'+key).update(memo);
                }else{
                    const updates={};
                    updates['memos/'+oldDate+'/'+key]=null;
                    updates['memos/'+newDate+'/'+key]=memo;
                    await database.ref().update(updates);
                }
                return true;
            }catch(error){
                console.error("Firebase update error: ",error);
                alert('‡¶Æ‡ßá‡¶Æ‡ßã ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶Ø‡¶æ‡ßü‡¶®‡¶ø‡•§');
                return false;
            }
        }

        let historyView = 'dates';
        let selectedHistoryDate = null;

        function displayHistory(){
            if(historyView==='dates'){
                displayDateList();
            }else if(historyView==='memos'&&selectedHistoryDate){
                displayMemosForDate(selectedHistoryDate);
            }
        }
        
        function displayDateList(){
            const historyList=document.getElementById('history-list');
            const historyPageTitle=document.getElementById('history-page-title');
            
            if (!historyList || !historyPageTitle) return;
            
            historyPageTitle.innerText='‡¶¶‡ßà‡¶®‡¶ø‡¶ï ‡¶π‡¶ø‡¶∏‡¶æ‡¶¨‡ßá‡¶∞ ‡¶§‡¶æ‡¶≤‡¶ø‡¶ï‡¶æ';
            
            const memosRef=database.ref('memos').orderByKey();
            memosRef.on('value',(snapshot)=>{
                historyList.innerHTML='';
                
                if(!snapshot.exists()){
                    historyList.innerHTML=`<div class="empty-state-container">
                        <div class="empty-state-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10 9 9 9 8 9"></polyline></svg>
                        </div>
                        <h2 class="empty-state-title">‡¶è‡¶ñ‡¶®‡ßã ‡¶ï‡ßã‡¶®‡ßã ‡¶Æ‡ßá‡¶Æ‡ßã ‡¶®‡ßá‡¶á!</h2>
                        <p class="empty-state-subtitle">‡¶®‡¶§‡ßÅ‡¶® ‡¶Æ‡ßá‡¶Æ‡ßã ‡¶§‡ßà‡¶∞‡¶ø ‡¶ï‡¶∞‡¶§‡ßá '‡¶π‡ßã‡¶Æ' ‡¶¨‡¶æ‡¶ü‡¶®‡ßá ‡¶Ö‡¶•‡¶¨‡¶æ '+' ‡¶¨‡¶æ‡¶ü‡¶®‡ßá ‡¶ü‡ßç‡¶Ø‡¶æ‡¶™ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§</p>
                    </div>`;
                    return;
                }
                
                const dates=Object.keys(snapshot.val());
                dates.reverse().forEach(date=>{
                    const memosOnDate=snapshot.child(date).val();
                    let memoCount=0;
                    let dailyTotal=0;
                    let dailyAdvance=0;
                    
                    for(const key in memosOnDate){
                        const memo=memosOnDate[key];
                        if(selectedShopId&&memo.shopId!==selectedShopId) continue;
                        memoCount++;
                        dailyTotal+=parseFloat(memo.grandTotal||0);
                        dailyAdvance+=parseFloat(memo.advance||0);
                    }
                    
                    if(memoCount===0) return;
                    
                    const numFormatOptions={minimumFractionDigits:2,maximumFractionDigits:2};
                    const formattedDate=new Date(date).toLocaleDateString('bn-BD',{year:'numeric',month:'long',day:'numeric'});
                    const listItem=document.createElement('li');
                    listItem.className='date-history-item';
                    listItem.innerHTML=`
                        <div class="date-primary-info">
                            <div class="date-header">üóìÔ∏è ${formattedDate}</div>
                            <div class="memo-count">üìù ${memoCount.toLocaleString('bn-BD')} ‡¶ü‡¶ø ‡¶Æ‡ßá‡¶Æ‡ßã</div>
                        </div>
                        <div class="date-totals-info">
                            <div class="total-item"><span>‡¶Æ‡ßã‡¶ü ‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞:</span><strong>‡ß≥ ${dailyTotal.toLocaleString('bn-BD',numFormatOptions)}</strong></div>
                            <div class="total-item advance"><span>‡¶Æ‡ßã‡¶ü ‡¶Ö‡¶ó‡ßç‡¶∞‡¶ø‡¶Æ:</span><strong>‡ß≥ ${dailyAdvance.toLocaleString('bn-BD',numFormatOptions)}</strong></div>
                        </div>
                    `;
                    listItem.onclick=()=>{
                        historyView='memos';
                        selectedHistoryDate=date;
                        displayHistory();
                    };
                    historyList.appendChild(listItem);
                });
            }, (error) => {
                console.error("Error loading history:", error);
                historyList.innerHTML=`<div class="empty-state-container"><h2 class="empty-state-title">‡¶°‡ßá‡¶ü‡¶æ ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ</h2><p class="empty-state-subtitle">‡¶¶‡¶Ø‡¶º‡¶æ ‡¶ï‡¶∞‡ßá ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®</p></div>`;
            });
        }
        
        function displayMemosForDate(date){
            const historyList=document.getElementById('history-list');
            const historyPageTitle=document.getElementById('history-page-title');
            
            if (!historyList || !historyPageTitle) return;
            
            const formattedDate=new Date(date).toLocaleDateString('bn-BD',{year:'numeric',month:'long',day:'numeric'});
            historyPageTitle.innerHTML=`<a href="#" id="back-to-dates" style="text-decoration:none; color: var(--primary-blue); font-weight: 500; font-size:16px;">&#8592; ‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ‡ßá ‡¶´‡¶ø‡¶∞‡ßÅ‡¶®</a> <span style="color: #64748B;">|</span> ${formattedDate}`;
            
            const memosRef=database.ref('memos/'+date).orderByChild('timestamp');
            memosRef.on('value',(snapshot)=>{
                historyList.innerHTML='';
                
                if(!snapshot.exists()){
                    historyList.innerHTML='<li class="memo-list-item">‡¶è‡¶á ‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ‡ßá ‡¶ï‡ßã‡¶®‡ßã ‡¶Æ‡ßá‡¶Æ‡ßã ‡¶™‡¶æ‡¶ì‡ßü‡¶æ ‡¶Ø‡¶æ‡ßü‡¶®‡¶ø‡•§</li>';
                    return;
                }
                
                let memos=[];
                snapshot.forEach(childSnapshot=>{
                    const memo=childSnapshot.val();
                    if(selectedShopId&&memo.shopId!==selectedShopId) return;
                    memos.push({ key:childSnapshot.key, ...memo });
                });
                
                memos.reverse().forEach(memo=>{
                    const listItem=document.createElement('li');
                    listItem.className='memo-list-item';
                    listItem.innerHTML=`
                        <span><strong>${memo.memoNo||'N/A'}</strong> - ${memo.customerName||'N/A'} (‡¶Æ‡ßã‡¶ü: ‡ß≥ ${parseFloat(memo.grandTotal||0).toLocaleString('bn-BD')})</span>
                        <div class="controls">
                            <button class="btn btn-add" onclick="viewMemoFromHistory('${memo.key}','${date}')">‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®</button>
                            <button class="btn" style="background:#f59e0b" onclick="loadMemoFromHistory('${memo.key}','${date}')">‡¶∏‡¶Æ‡ßç‡¶™‡¶æ‡¶¶‡¶®‡¶æ</button>
                            <button class="btn btn-delete" onclick="deleteMemoFromHistory('${memo.key}','${date}')">‡¶Æ‡ßÅ‡¶õ‡ßÅ‡¶®</button>
                        </div>
                    `;
                    historyList.appendChild(listItem);
                });
                
                const backButton = document.getElementById('back-to-dates');
                if (backButton) {
                    backButton.onclick=(e)=>{
                        e.preventDefault();
                        historyView='dates';
                        selectedHistoryDate=null;
                        displayHistory();
                    };
                }
            }, (error) => {
                console.error("Error loading memos for date:", error);
                historyList.innerHTML='<li class="memo-list-item">‡¶°‡ßá‡¶ü‡¶æ ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá‡•§</li>';
            });
        }
        
        async function deleteMemoFromHistory(key,date){
            if(confirm('‡¶Ü‡¶™‡¶®‡¶ø ‡¶ï‡¶ø ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§‡¶≠‡¶æ‡¶¨‡ßá ‡¶è‡¶á ‡¶Æ‡ßá‡¶Æ‡ßã‡¶ü‡¶ø ‡¶Æ‡ßÅ‡¶õ‡¶§‡ßá ‡¶ö‡¶æ‡¶®? ‡¶è‡¶ü‡¶ø ‡¶´‡ßá‡¶∞‡¶§ ‡¶Ü‡¶®‡¶æ ‡¶Ø‡¶æ‡¶¨‡ßá ‡¶®‡¶æ‡•§')){
                try{
                    await database.ref('memos/'+date+'/'+key).remove();
                }catch(error){
                    console.error("Firebase delete error: ",error);
                    alert('‡¶Æ‡ßá‡¶Æ‡ßã‡¶ü‡¶ø ‡¶Æ‡ßã‡¶õ‡¶æ ‡¶Ø‡¶æ‡ßü‡¶®‡¶ø‡•§');
                }
            }
        }
        
        async function loadMemoFromHistory(key,date){
            try{
                const snapshot=await database.ref('memos/'+date+'/'+key).once('value');
                const memo=snapshot.val();
                if(!memo){
                    alert('‡¶Æ‡ßá‡¶Æ‡ßã‡¶ü‡¶ø ‡¶ñ‡ßÅ‡¶Å‡¶ú‡ßá ‡¶™‡¶æ‡¶ì‡ßü‡¶æ ‡¶Ø‡¶æ‡ßü‡¶®‡¶ø‡•§');
                    return;
                }
                
                document.getElementById('memo-no').value=memo.memoNo||'';
                document.getElementById('customer-name').value=memo.customerName||'';
                document.getElementById('customer-address').value=memo.customerAddress||'';
                document.getElementById('transaction-date').value=memo.transactionDate||'';
                document.getElementById('delivery-date').value=memo.deliveryDate||'';
                document.getElementById('advance').value=memo.advance||0;
                
                selectedShopId = memo.shopId;
                updateCustomDropdowns();
                
                const tableBody=document.querySelector('#bill-table tbody');
                tableBody.innerHTML='';
                
                (memo.items||[]).forEach(item=>{
                    let newRow=tableBody.insertRow();
                    newRow.innerHTML=`<td></td><td><input type="text" class="product-name" value="${item.name||''}"></td><td><input type="number" class="quantity" value="${item.quantity||1}" min="1" oninput="calculateRow(this);"></td><td><input type="number" class="price" value="${item.price||0}" min="0" oninput="calculateRow(this);"></td><td><input type="text" class="amount" value="${item.amount||0}" readonly></td><td><button class="btn btn-remove" onclick="removeRow(this)">üóëÔ∏è</button></td>`;
                });
                
                if((memo.items||[]).length===0){
                    addRow();
                }
                
                updateSerialNumbers();
                calculateTotals();
                currentlyEditing={key:key,date:date};
                document.getElementById('print-save-btn').innerText='‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ì ‡¶™‡ßç‡¶∞‡¶ø‡¶≠‡¶ø‡¶â ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶® üîÑ';
                showMemoPage();
            }catch(error){
                console.error("Firebase load error: ",error);
                alert('‡¶Æ‡ßá‡¶Æ‡ßã ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶æ ‡¶Ø‡¶æ‡ßü‡¶®‡¶ø‡•§');
            }
        }
        
        function numberToWordsBengali(num){const single=['','‡¶è‡¶ï','‡¶¶‡ßÅ‡¶á','‡¶§‡¶ø‡¶®','‡¶ö‡¶æ‡¶∞','‡¶™‡¶æ‡¶Å‡¶ö','‡¶õ‡ßü','‡¶∏‡¶æ‡¶§','‡¶Ü‡¶ü','‡¶®‡ßü'],teens=['‡¶¶‡¶∂','‡¶è‡¶ó‡¶æ‡¶∞‡ßã','‡¶¨‡¶æ‡¶∞‡ßã','‡¶§‡ßá‡¶∞‡ßã','‡¶ö‡ßã‡¶¶‡ßç‡¶¶','‡¶™‡¶®‡ßá‡¶∞‡ßã','‡¶∑‡ßã‡¶≤','‡¶∏‡¶§‡ßá‡¶∞‡ßã','‡¶Ü‡¶†‡¶æ‡¶∞‡ßã','‡¶â‡¶®‡¶ø‡¶∂'],tens=['','','‡¶¨‡¶ø‡¶∂','‡¶§‡ßç‡¶∞‡¶ø‡¶∂','‡¶ö‡¶≤‡ßç‡¶≤‡¶ø‡¶∂','‡¶™‡¶û‡ßç‡¶ö‡¶æ‡¶∂','‡¶∑‡¶æ‡¶ü','‡¶∏‡¶§‡ßç‡¶§‡¶∞','‡¶Ü‡¶∂‡¶ø','‡¶®‡¶¨‡ßç‡¶¨‡¶á'],powers=['',' ‡¶π‡¶æ‡¶ú‡¶æ‡¶∞',' ‡¶≤‡¶ï‡ßç‡¶∑',' ‡¶ï‡ßã‡¶ü‡¶ø'];function convert(n){if(n<10)return single[n];if(n<20)return teens[n-10];if(n<100)return tens[Math.floor(n/10)]+(n%10!==0?' '+single[n%10]:'');if(n<1000)return single[Math.floor(n/100)]+' ‡¶∂‡¶§'+(n%100!==0?' '+convert(n%100):'');return convert(Math.floor(n/1000))+' ‡¶π‡¶æ‡¶ú‡¶æ‡¶∞'+(n%1000!==0?' '+convert(n%1000):'')}if(num===0)return'‡¶∂‡ßÇ‡¶®‡ßç‡¶Ø';let words='',i=0;while(num>0){let chunk=(i===0)?num%1000:num%100;if(chunk>0){words=convert(chunk)+powers[i]+' '+words}num=(i===0)?Math.floor(num/1000):Math.floor(num/100);i++}return words.trim()}
        
        // --- ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶ø‡¶§ ‡¶™‡ßç‡¶∞‡¶ø‡¶®‡ßç‡¶ü ‡¶ú‡ßá‡¶®‡¶æ‡¶∞‡ßá‡¶ü ‡¶´‡¶æ‡¶Ç‡¶∂‡¶® ---
        function generatePrintContent(memoData) {
            const staticShopInfo = {
                name: "‡¶Ü‡¶¨‡ßç‡¶¶‡ßÅ‡¶≤‡ßç‡¶≤‡¶æ‡¶π ‡¶á‡¶≤‡ßá‡¶ï‡¶ü‡ßç‡¶∞‡¶ø‡¶ï ‡¶è‡¶®‡ßç‡¶° ‡¶á‡¶≤‡ßá‡¶ï‡¶ü‡ßç‡¶∞‡¶®‡¶ø‡¶ï‡ßç‡¶∏",
                proprietor: "‡¶™‡ßç‡¶∞‡ßã‡¶É ‡¶Æ‡ßã‡¶É ‡¶Ü‡¶¨‡ßç‡¶¶‡ßÅ‡¶≤‡ßç‡¶≤‡¶æ‡¶π ‡¶Æ‡ßã‡¶≤‡ßç‡¶≤‡¶æ",
                details1: "‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶∏‡¶ï‡¶≤ ‡¶™‡ßç‡¶∞‡¶ï‡¶æ‡¶∞ ‡¶á‡¶≤‡ßá‡¶ï‡¶ü‡ßç‡¶∞‡¶®‡¶ø‡¶ï ‡¶ì ‡¶á‡¶≤‡ßá‡¶ï‡¶ü‡ßç‡¶∞‡¶®‡¶ø‡¶ï‡ßç‡¶∏ ‡¶Ü‡¶á‡¶ü‡ßá‡¶Æ ‡¶∏‡ßÅ‡¶≤‡¶≠ ‡¶Æ‡ßÇ‡¶≤‡ßç‡¶Ø‡ßá ‡¶¨‡¶ø‡¶ï‡ßç‡¶∞‡ßü ‡¶è‡¶¨‡¶Ç ‡¶Æ‡ßá‡¶∞‡¶æ‡¶Æ‡¶§ ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡•§",
                contact: "‡¶Ø‡ßã‡¶ó‡¶æ‡¶Ø‡ßã‡¶ó‡¶É ‡ß¶‡ßß‡ß©‡ß®‡ß¨-‡ßß‡ß≠‡ß¶‡ß≠‡ß≠‡ß≠",
                logoUrl: "https://i.ibb.co/fYwdd8h/IMG-20251107-WA0006.jpg"
            };

            const selectedShop = memoData.shopId && shops[memoData.shopId] ? shops[memoData.shopId] : null;
            
            const { memoNo, customerName, customerAddress, transactionDate, deliveryDate, items, grandTotal, advance, due } = memoData;
            const formattedTransactionDate = transactionDate ? new Date(transactionDate).toLocaleDateString('bn-BD') : 'N/A';
            const formattedDeliveryDate = deliveryDate ? new Date(deliveryDate).toLocaleDateString('bn-BD') : 'N/A';
            const amountInWords = numberToWordsBengali(Math.round(grandTotal));

            let tableRows = '';
            items.forEach((item, index) => {
                const pName = (item.name || '').replace(/\n/g, '<br>');
                const qty = item.quantity || 1;
                const price = (parseFloat(item.price || 0)).toFixed(2);
                const amount = (parseFloat(item.amount || 0)).toFixed(2);
                tableRows += `<tr><td style="text-align:center;">${index + 1}</td><td>${pName}</td><td style="text-align:center;">${qty}</td><td style="text-align:right;">${price}</td><td style="text-align:right;">${amount}</td></tr>`;
            });

            let selectedShopHtml = '';
            if (selectedShop) {
                selectedShopHtml = `
                    <div class="selected-shop-info" style="margin-top: 30px; padding: 20px; border: 1px solid #e2e8f0; border-radius: 10px; background: #f8faff;">
                        <h3 style="text-align: center; color: #0052D4; margin-top: 0; border-bottom: 1px solid #e2e8f0; padding-bottom: 10px; margin-bottom: 15px;">‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶ø‡¶§ ‡¶¶‡ßã‡¶ï‡¶æ‡¶®</h3>
                        <div style="display: flex; align-items: center; gap: 20px;">
                            <img src="${selectedShop.logoUrl}" alt="Shop Logo" style="height: 60px; border-radius: 8px;">
                            <div>
                                <p style="font-size: 16px; font-weight: 600; margin: 0;">${selectedShop.name}</p>
                                <p style="font-size: 14px; color: #64748B; margin: 5px 0;">${selectedShop.proprietor}</p>
                                <p style="font-size: 14px; color: #64748B; margin: 5px 0;">${selectedShop.contact}</p>
                            </div>
                        </div>
                    </div>
                `;
            }
            
            return `<html><head><title>Memo - ${customerName}</title><link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet"><style>body{font-family:'Poppins',sans-serif;margin:0;padding:20px;background-color:#f9fafb;color:#1e293b;font-size:14px; min-width: 750px;}.memo-container{max-width:800px;margin:20px auto;background:#fff;border-radius:15px;box-shadow:0 10px 30px rgba(0,0,0,.07);overflow:hidden;border:1px solid #e2e8f0}.memo-header{padding:30px;position:relative;background-color:#f8faff;border-bottom:1px solid #e2e8f0}.header-shape-left{position:absolute;top:0;left:0;width:45%;height:100%;background-color:#4FD1C5;clip-path:ellipse(100% 70% at 0% 50%);opacity:.1}.header-shape-right{position:absolute;top:-20px;right:20px;width:120px;height:120px;background-color:#F472B6;border-radius:30px;transform:rotate(45deg);opacity:.15}.shop-info{text-align:center;position:relative;z-index:2}.shop-logo{height:60px;border-radius:12px;margin-bottom:10px;border:3px solid #fff;box-shadow:0 4px 10px rgba(0,0,0,.08)}.shop-name{font-size:28px;font-weight:700;color:#0052D4;margin:0}.shop-details{font-size:13px;color:#64748B;margin:5px 0}.customer-info-section{display:grid;grid-template-columns:1fr 1fr;gap:12px 20px;padding:25px 30px;border-bottom:1px solid #e2e8f0}.info-field{display:flex;align-items:stretch;border-radius:8px;overflow:hidden;border:1px solid #e2e8f0;background:#f8faff}.info-field span{font-weight:600;padding:8px 12px;color:white;background-color:#4A90E2;display:flex;align-items:center;white-space:nowrap}.info-field p{margin:0;padding:8px 12px;width:100%; word-break: break-word;}.info-field.full-width{grid-column:1/-1}.memo-body{padding:25px 30px}
            .products-table{width:100%;border-collapse:collapse;border:1px solid #e2e8f0;border-radius:10px;overflow:hidden; table-layout: fixed;}
            .products-table th,.products-table td{padding:12px 15px;text-align:left;border-bottom:1px solid #e2e8f0;word-wrap:break-word; overflow-wrap: break-word;}
            .products-table th{background-color:#4A90E2;color:#fff;font-size:13px;text-transform:uppercase;font-weight:600;letter-spacing:.5px}.products-table td{border-right:1px solid #e2e8f0}.products-table th{border-right:1px solid #63a5e8}.products-table th:last-child,.products-table td:last-child{border-right:none}.products-table tbody tr:nth-child(even){background-color:#f8faff}.memo-footer{padding:25px 30px 30px;display:flex;justify-content:space-between;align-items:flex-start;background-color:#f8faff;border-top:1px solid #e2e8f0}.notes{width:55%}.notes p{font-size:13px;color:#64748B;margin-top:0}.notes b{color:#1E293B}.totals-section{width:35%}.totals-table{width:100%;border-collapse:collapse}.totals-table td{padding:10px;font-size:15px;border-bottom:1px solid #e2e8f0}.totals-table tr:last-child td{border-bottom:none}.totals-table .label{color:#64748B}.totals-table .value{text-align:right;font-weight:700;color:#1E293B}.totals-table tr:nth-child(1) .value{border-left:4px solid #334155;padding-right:10px}.totals-table tr:nth-child(2) .value{border-left:4px solid #F472B6;padding-right:10px}.totals-table tr.due .value{font-size:18px;color:#0052D4;background-color:#e9efff;border-left:4px solid #0052D4;padding-right:10px}.signature-section{display:flex;justify-content:space-between;margin-top:70px;padding:0 40px}.signature-line{border-top:1px dotted #64748B;width:200px;text-align:center;padding-top:8px;font-weight:600}.final-note{text-align:center;margin-top:40px;font-size:13px;color:#64748B;padding:20px 30px;border-top:1px solid #e2e8f0}.final-note-bar{height:8px;background:linear-gradient(90deg,#4FD1C5,#4A90E2,#F472B6)}
            @media print { body { -webkit-print-color-adjust: exact; print-color-adjust: exact; } }
            </style></head>
                <body><div class="memo-container"><div class="memo-header"><div class="header-shape-left"></div><div class="header-shape-right"></div><div class="shop-info"><img src="${staticShopInfo.logoUrl}" alt="Logo" class="shop-logo"><h1 class="shop-name">${staticShopInfo.name}</h1><p class="shop-details">${staticShopInfo.proprietor}</p><p class="shop-details">${staticShopInfo.details1}</p><p class="shop-details">${staticShopInfo.contact}</p></div></div><div class="customer-info-section"><div class="info-field"><span>‡¶®‡¶æ‡¶Æ‡¶É</span><p>${customerName}</p></div><div class="info-field"><span>‡¶Æ‡ßá‡¶Æ‡ßã ‡¶®‡¶Ç:</span><p>${memoNo}</p></div><div class="info-field full-width"><span>‡¶†‡¶ø‡¶ï‡¶æ‡¶®‡¶æ‡¶É</span><p>${customerAddress}</p></div><div class="info-field"><span>‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ‡¶É</span><p>${formattedTransactionDate}</p></div><div class="info-field"><span>‡¶°‡ßá‡¶≤‡¶ø‡¶≠‡¶æ‡¶∞‡¶ø ‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ‡¶É</span><p>${formattedDeliveryDate}</p></div></div><div class="memo-body"><table class="products-table"><thead><tr><th style="width:5%;text-align:center;">‡¶®‡¶Ç</th><th style="width:50%;">‡¶¨‡¶ø‡¶¨‡¶∞‡¶£</th><th style="width:10%;text-align:center;">‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£</th><th style="width:15%;text-align:right;">‡¶¶‡¶∞</th><th style="width:20%;text-align:right;">‡¶ü‡¶æ‡¶ï‡¶æ</th></tr></thead><tbody>${tableRows}</tbody></table> ${selectedShopHtml}</div><div class="memo-footer"><div class="notes"><p><b>‡¶ï‡¶•‡¶æ‡ßü‡¶É</b> ${amountInWords} ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶Æ‡¶æ‡¶§‡ßç‡¶∞‡•§</p></div><div class="totals-section"><table class="totals-table"><tbody><tr><td class="label">‡¶Æ‡ßã‡¶ü</td><td class="value">${parseFloat(grandTotal).toFixed(2)}</td></tr><tr><td class="label">‡¶Ö‡¶ó‡ßç‡¶∞‡¶ø‡¶Æ</td><td class="value">${parseFloat(advance).toFixed(2)}</td></tr><tr class="due"><td class="label"><strong>‡¶¨‡¶æ‡¶ï‡¶ø</strong></td><td class="value"><strong>${parseFloat(due).toFixed(2)}</strong></td></tr></tbody></table></div></div><div class="signature-section"><div class="signature-line">‡¶ï‡ßç‡¶∞‡ßá‡¶§‡¶æ‡¶∞ ‡¶∏‡ßç‡¶¨‡¶æ‡¶ï‡ßç‡¶∑‡¶∞</div><div class="signature-line">‡¶¨‡¶ø‡¶ï‡ßç‡¶∞‡ßá‡¶§‡¶æ‡¶∞ ‡¶∏‡ßç‡¶¨‡¶æ‡¶ï‡ßç‡¶∑‡¶∞</div></div><div class="final-note">‡¶¨‡¶ø‡¶ï‡ßç‡¶∞‡¶ø‡¶§ ‡¶Æ‡¶æ‡¶≤ ‡¶´‡ßá‡¶∞‡¶§ ‡¶®‡ßá‡ßü‡¶æ ‡¶π‡ßü ‡¶®‡¶æ‡•§ ‡¶ß‡¶®‡ßç‡¶Ø‡¶¨‡¶æ‡¶¶‡•§</div><div class="final-note-bar"></div></div></body></html>`;
        }


        function executePrint(htmlContent) {
            const iframe = document.createElement('iframe');
            iframe.style.display = 'none';
            document.body.appendChild(iframe);
            iframe.contentDocument.write(htmlContent);
            iframe.contentDocument.close();
            iframe.contentWindow.focus();
            setTimeout(() => {
                iframe.contentWindow.print();
                document.body.removeChild(iframe);
            }, 500);
        }

        // --- ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶ø‡¶§ ‡¶™‡ßç‡¶∞‡¶ø‡¶≠‡¶ø‡¶â ‡¶´‡¶æ‡¶Ç‡¶∂‡¶® ---
        function showMemoPreview(memoData, backPage) {
            const memoContent = generatePrintContent(memoData);
            
            previewPage.innerHTML = `
                <div class="container">
                    <div class="header-bar" style="margin-bottom: 20px; justify-content: space-between;">
                        <button class="btn btn-remove" id="preview-back-btn" style="font-size: 14px; padding: 10px 16px;">&larr; ‡¶´‡¶ø‡¶∞‡ßá ‡¶Ø‡¶æ‡¶®</button>
                        <h1 style="font-size: 20px; margin: 0 15px;">‡¶Æ‡ßá‡¶Æ‡ßã ‡¶™‡ßç‡¶∞‡¶ø‡¶≠‡¶ø‡¶â</h1>
                        <button class="btn btn-add" id="preview-print-btn" style="font-size: 14px; padding: 10px 16px;">‡¶™‡ßç‡¶∞‡¶ø‡¶®‡ßç‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶® üñ®Ô∏è</button>
                    </div>
                    <div id="memo-content-for-print" style="border: 1px solid #e2e8f0; border-radius: 12px; padding: 10px;">
                        ${memoContent}
                    </div>
                </div>
            `;

            homePage.style.display = 'none';
            mainContent.style.display = 'none';
            historyPage.style.display = 'none';
            shopPage.style.display = 'none';
            previewPage.style.display = 'block';
            window.scrollTo(0, 0); // ‡¶™‡ßá‡¶ú‡ßá‡¶∞ ‡¶∂‡ßÅ‡¶∞‡ßÅ‡¶§‡ßá ‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶≤ ‡¶ï‡¶∞‡ßÅ‡¶®

            document.getElementById('preview-print-btn').onclick = () => {
                const contentToPrint = document.getElementById('memo-content-for-print').innerHTML;
                executePrint(contentToPrint);
            };

            document.getElementById('preview-back-btn').onclick = () => {
                previewPage.style.display = 'none';
                if (backPage === 'history') {
                    showHistoryPage(true);
                } else {
                    showMemoPage();
                }
            };
        }
        
        async function viewMemoFromHistory(key, date) {
            try {
                const snapshot = await database.ref('memos/' + date + '/' + key).once('value');
                const memo = snapshot.val();
                if (!memo) { alert('‡¶Æ‡ßá‡¶Æ‡ßã‡¶ü‡¶ø ‡¶ñ‡ßÅ‡¶Å‡¶ú‡ßá ‡¶™‡¶æ‡¶ì‡ßü‡¶æ ‡¶Ø‡¶æ‡ßü‡¶®‡¶ø‡•§'); return; }
                showMemoPreview(memo, 'history'); // ‡¶´‡¶ø‡¶∞‡ßá ‡¶Ø‡¶æ‡¶ì‡ßü‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø 'history' ‡¶™‡ßá‡¶ú ‡¶∏‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶π‡¶≤‡ßã
            } catch (error) {
                console.error("Firebase view error: ", error);
                alert('‡¶Æ‡ßá‡¶Æ‡ßã‡¶ü‡¶ø ‡¶¶‡ßá‡¶ñ‡¶æ‡¶®‡ßã ‡¶Ø‡¶æ‡¶ö‡ßç‡¶õ‡ßá ‡¶®‡¶æ‡•§');
            }
        }
        
        async function saveAndShowPreview(){
            let success = false;
            if(currentlyEditing){
                success = await updateBillInHistory();
            }else{
                success = await saveBillToHistory();
            }

            if(success){
                const currentMemoData = collectMemoData();
                showMemoPreview(currentMemoData, 'memo'); // ‡¶´‡¶ø‡¶∞‡ßá ‡¶Ø‡¶æ‡¶ì‡ßü‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø 'memo' ‡¶™‡ßá‡¶ú ‡¶∏‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶π‡¶≤‡ßã
                resetForm();
            }
        }
        
        function resetEditingState(){
            currentlyEditing=null;
            const printSaveBtn = document.getElementById('print-save-btn');
            if (printSaveBtn) printSaveBtn.innerText='‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶£ ‡¶ì ‡¶™‡ßç‡¶∞‡¶ø‡¶≠‡¶ø‡¶â ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶® üìÑ';
        }
        
        function resetForm(){
            const memoNo = document.getElementById('memo-no');
            const customerName = document.getElementById('customer-name');
            const customerAddress = document.getElementById('customer-address');
            const transactionDate = document.getElementById('transaction-date');
            const deliveryDate = document.getElementById('delivery-date');
            const advance = document.getElementById('advance');
            const tableBody = document.querySelector('#bill-table tbody');
            
            if (memoNo) memoNo.value='';
            if (customerName) customerName.value='';
            if (customerAddress) customerAddress.value='';
            
            const today=new Date().toISOString().split('T')[0];
            if (transactionDate) transactionDate.value=today;
            if (deliveryDate) deliveryDate.value=today;
            
            if (advance) advance.value=0;
            if (tableBody) tableBody.innerHTML='';
            
            addRow();
            calculateTotals();
            resetEditingState();
            closeNav();
        }

        // --- Event Listeners ---
        document.addEventListener('DOMContentLoaded',()=>{
            initializeCustomDropdowns();
            fetchShops();
            initSlider();
            resetForm(); 
            showHomeDashboard();
            
            const today = new Date().toISOString().split('T')[0];
            const transactionDate = document.getElementById('transaction-date');
            const deliveryDate = document.getElementById('delivery-date');
            
            if (transactionDate) transactionDate.value = today;
            if (deliveryDate) deliveryDate.value = today;
            
            addRow();
        });

        // Navigation Event Listeners
        const sideHomeBtn=document.getElementById('side-home-btn'),
              sideNewMemoBtn=document.getElementById('side-new-memo-btn'),
              sideShowHistoryBtn=document.getElementById('side-show-history-btn'),
              sideShopBtn=document.getElementById('side-shop-btn'),
              sidePrivacyBtn=document.getElementById('side-privacy-btn'),
              bottomNavHome=document.getElementById('bottom-nav-home'),
              bottomNavMemo=document.getElementById('bottom-nav-memo'),
              bottomNavHistory=document.getElementById('bottom-nav-history'),
              bottomNavShop=document.getElementById('bottom-nav-shop');

        if (sideHomeBtn) sideHomeBtn.onclick=()=>{ showHomeDashboard(); closeNav(); };
        if (sideNewMemoBtn) sideNewMemoBtn.onclick=()=>{ resetForm(); showMemoPage(); closeNav(); };
        if (sideShowHistoryBtn) sideShowHistoryBtn.onclick=()=>{ showHistoryPage(false); closeNav(); };
        if (sideShopBtn) sideShopBtn.onclick=()=>{ showShopPage(); closeNav(); };
        if (sidePrivacyBtn) sidePrivacyBtn.onclick=()=>{ document.getElementById('privacyModal').style.display='block'; closeNav(); };
        
        if (bottomNavHome) bottomNavHome.onclick=(e)=>{ e.preventDefault(); showHomeDashboard(); };
        if (bottomNavMemo) bottomNavMemo.onclick=(e)=>{ e.preventDefault(); resetForm(); showMemoPage(); };
        if (bottomNavHistory) bottomNavHistory.onclick=(e)=>{ e.preventDefault(); showHistoryPage(true); };
        if (bottomNavShop) bottomNavShop.onclick=(e)=>{ e.preventDefault(); showShopPage(); };
        
        if (fabAddMemo) fabAddMemo.onclick=()=>{ resetForm(); showMemoPage(); };

        // Modal close buttons
        const shopEditModalCloseBtn=document.getElementById('shop-edit-modal-close-btn'),
              privacyModalCloseBtn=document.getElementById('privacy-modal-close-btn'),
              saveShopInfoBtn=document.getElementById('save-shop-info-btn');

        if (shopEditModalCloseBtn) shopEditModalCloseBtn.onclick=()=> document.getElementById('shopEditModal').style.display="none";
        if (privacyModalCloseBtn) privacyModalCloseBtn.onclick=()=> document.getElementById('privacyModal').style.display="none";
        
        if (saveShopInfoBtn) {
            saveShopInfoBtn.onclick=()=>{
                const newShopInfo={
                    name: document.getElementById('shop-name-input').value,
                    proprietor: document.getElementById('proprietor-name-input').value,
                    details1: document.getElementById('shop-details1-input').value,
                    contact: document.getElementById('shop-contact-input').value,
                    logoUrl: document.getElementById('shop-logo-input').value
                };
                
                const shopId = document.getElementById('save-shop-info-btn').getAttribute('data-shop-id');
                
                if (shopId) {
                    database.ref('shops/' + shopId).update(newShopInfo)
                        .then(() => {
                            alert('‡¶¶‡ßã‡¶ï‡¶æ‡¶®‡ßá‡¶∞ ‡¶§‡¶•‡ßç‡¶Ø ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá!');
                            document.getElementById('shopEditModal').style.display = 'none';
                            loadShopList();
                        })
                        .catch(error => {
                            console.error("Error updating shop:", error);
                            alert('‡¶§‡¶•‡ßç‡¶Ø ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶Ø‡¶æ‡ßü‡¶®‡¶ø‡•§ ‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø: ' + error);
                        });
                } else {
                    const newShopRef = database.ref('shops').push();
                    newShopRef.set(newShopInfo)
                        .then(() => {
                            alert('‡¶®‡¶§‡ßÅ‡¶® ‡¶¶‡ßã‡¶ï‡¶æ‡¶® ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶§‡ßà‡¶∞‡¶ø ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá!');
                            selectedShopId = newShopRef.key;
                            document.getElementById('shopEditModal').style.display = 'none';
                            updateCustomDropdowns();
                            loadShopList();
                        })
                        .catch(error => {
                            console.error("Error creating shop:", error);
                            alert('‡¶¶‡ßã‡¶ï‡¶æ‡¶® ‡¶§‡ßà‡¶∞‡¶ø ‡¶ï‡¶∞‡¶æ ‡¶Ø‡¶æ‡ßü‡¶®‡¶ø‡•§ ‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø: ' + error);
                        });
                }
            };
        }

        window.onclick=(event)=>{
            if(event.target==document.getElementById('shopEditModal')) document.getElementById('shopEditModal').style.display="none";
            if(event.target==document.getElementById('privacyModal')) document.getElementById('privacyModal').style.display="none";
        };
    </script>
</body>
</html>
