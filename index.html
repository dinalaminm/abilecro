<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡¶Ü‡¶¨‡ßç‡¶¶‡ßÅ‡¶≤‡ßç‡¶≤‡¶æ‡¶π ‡¶á‡¶≤‡ßá‡¶ï‡¶ü‡ßç‡¶∞‡¶ø‡¶ï - ‡¶¨‡¶ø‡¶≤ ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶ú‡¶Æ‡ßá‡¶®‡ßç‡¶ü</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-blue: #4A90E2;
            --primary-blue-dark: #0052D4;
            --light-blue-bg: #F0F4FF;
            --white-color: #FFFFFF;
            --text-dark: #1E293B;
            --text-light: #64748B;
            --border-color: #E2E8F0;
        }

        body {
            font-family: 'Poppins', sans-serif;
            margin: 0;
            padding: 20px;
            background-color: var(--light-blue-bg);
            color: var(--text-dark);
        }
        .header-bar {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
        }
        .menu-btn {
            font-size: 30px;
            cursor: pointer;
            padding: 0 15px;
            color: var(--text-dark);
        }
        .sidenav {
            height: 100%;
            width: 0; /* Initially hidden */
            position: fixed;
            z-index: 1000;
            top: 0;
            left: 0;
            background-color: var(--white-color);
            overflow-x: hidden;
            transition: 0.5s;
            padding-top: 60px;
            box-shadow: 3px 0 15px rgba(0,0,0,0.1);
        }
        .sidenav a {
            padding: 12px 15px 12px 32px;
            text-decoration: none;
            font-size: 18px;
            color: var(--text-dark);
            display: block;
            transition: 0.3s;
        }
        .sidenav a:hover {
            background-color: var(--light-blue-bg);
            color: var(--primary-blue);
        }
        .sidenav .close-btn {
            position: absolute;
            top: 15px;
            right: 25px;
            font-size: 36px;
        }
        .container {
            max-width: 900px;
            margin: auto;
            padding: 30px;
            background: var(--white-color);
            border-radius: 24px;
            box-shadow: 0 10px 30px rgba(65, 87, 128, 0.1);
        }
        h1 {
            text-align: center;
            margin: 0;
            color: var(--text-dark);
            font-weight: 700;
            flex-grow: 1;
        }
        .customer-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        input[type="text"], input[type="number"], input[type="date"] {
            width: 100%; padding: 12px 16px; box-sizing: border-box; background: #F8FAFC;
            border: 1px solid var(--border-color); border-radius: 12px; font-size: 16px;
            font-family: 'Poppins', sans-serif; transition: all 0.3s ease;
        }
        input:focus {
            outline: none; border-color: var(--primary-blue);
            box-shadow: 0 0 0 3px rgba(74, 144, 226, 0.2);
        }
        .table-wrapper { overflow-x: auto; }
        table { width: 100%; border-collapse: collapse; margin-bottom: 20px; }
        th, td { padding: 14px; text-align: center; border-bottom: 1px solid var(--border-color); }
        th { background-color: var(--primary-blue); color: white; font-weight: 600; font-size: 15px; }
        th:nth-child(2), td:nth-child(2) { text-align: left; }
        th:first-child { border-radius: 10px 0 0 10px; }
        th:last-child { border-radius: 0 10px 10px 0; }
        tr:last-child td { border-bottom: none; }
        .btn {
            padding: 12px 24px; border: none; border-radius: 12px; cursor: pointer;
            font-size: 16px; font-family: 'Poppins', sans-serif; transition: all 0.3s ease;
            font-weight: 600; color: white; background-size: 200% auto;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        .btn:hover { background-position: right center; transform: translateY(-2px); box-shadow: 0 6px 20px rgba(0,0,0,0.15); }
        .btn-add { background-image: linear-gradient(to right, var(--primary-blue) 0%, var(--primary-blue-dark) 51%, var(--primary-blue) 100%); }
        .btn-remove { background: #F1F5F9; color: var(--text-light); box-shadow: none;}
        .btn-remove:hover { background: #E2E8F0; color: var(--text-dark); transform: none; box-shadow: none; }
        .btn-print {
            background-image: linear-gradient(to right, var(--primary-blue) 0%, var(--primary-blue-dark) 51%, var(--primary-blue) 100%);
            display: block; width: 100%; margin-top: 20px; padding: 16px;
            font-size: 18px; font-weight: 700;
        }
        .totals-container { float: right; width: 300px; background: var(--light-blue-bg); padding: 20px; border-radius: 16px; margin-top: 15px; }
        .totals-table { width: 100%; border: none; }
        .totals-table td { border: none; padding: 10px; font-size: 16px; text-align: left; }
        .text-right { text-align: right; font-weight: 700; }
        .clearfix::after { content: ""; clear: both; display: table; }

        /* Modal Styles */
        .modal {
            display: none; position: fixed; z-index: 2000; left: 0; top: 0;
            width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.5);
        }
        .modal-content {
            background-color: #fefefe; margin: 10% auto; padding: 25px;
            border: 1px solid #888; width: 80%; max-width: 700px; border-radius: 15px;
        }
        .modal-header { display: flex; justify-content: space-between; align-items: center; }
        .modal-header h2 { margin: 0; }
        .modal-close-btn { color: #aaa; font-size: 28px; font-weight: bold; cursor: pointer; }
        #history-list { list-style: none; padding: 0; margin-top: 20px; }
        #history-list li {
            display: flex; justify-content: space-between; align-items: center;
            padding: 12px; border-bottom: 1px solid var(--border-color);
        }
        #history-list li:last-child { border-bottom: none; }
        #history-list button { padding: 6px 12px; font-size: 14px; }

        @media (max-width: 768px) {
            body { padding: 10px; } .container { padding: 20px; }
            .totals-container { float: none; width: auto; margin-top: 25px; padding: 15px; }
            h1 { font-size: 20px; } .menu-btn { font-size: 24px; padding: 0 10px; }
        }
    </style>
</head>
<body>

    <div id="mySidenav" class="sidenav">
        <a href="javascript:void(0)" class="close-btn" onclick="closeNav()">&times;</a>
        <a href="#" id="show-history-btn">‡¶Æ‡ßá‡¶Æ‡ßã‡¶∞ ‡¶π‡¶ø‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡¶ø</a>
    </div>

    <div class="container">
        <div class="header-bar">
            <span class="menu-btn" onclick="openNav()">&#9776;</span>
            <h1>‡¶¨‡¶ø‡¶≤ ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶ú‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶∏‡¶ø‡¶∏‡ßç‡¶ü‡ßá‡¶Æ</h1>
        </div>
        <div class="customer-info">
            <input type="text" id="memo-no" placeholder="‡¶Æ‡ßá‡¶Æ‡ßã ‡¶®‡¶Ç">
            <input type="text" id="customer-name" placeholder="‡¶ï‡ßç‡¶∞‡ßá‡¶§‡¶æ‡¶∞ ‡¶®‡¶æ‡¶Æ">
            <input type="text" id="customer-address" placeholder="‡¶ï‡ßç‡¶∞‡ßá‡¶§‡¶æ‡¶∞ ‡¶†‡¶ø‡¶ï‡¶æ‡¶®‡¶æ">
            <input type="date" id="delivery-date" title="‡¶°‡ßá‡¶≤‡¶ø‡¶≠‡¶æ‡¶∞‡¶ø ‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ">
        </div>
        <div class="table-wrapper">
            <table id="bill-table">
                <thead>
                    <tr>
                        <th>‡¶®‡¶Ç</th><th>‡¶¨‡¶ø‡¶¨‡¶∞‡¶£</th><th>‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£</th><th>‡¶¶‡¶∞</th><th>‡¶ü‡¶æ‡¶ï‡¶æ</th><th>‡¶Æ‡ßÅ‡¶õ‡ßÅ‡¶®</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Initial Row -->
                    <tr>
                        <td>1</td>
                        <td><input type="text" class="product-name" placeholder="‡¶™‡¶£‡ßç‡¶Ø‡ßá‡¶∞ ‡¶¨‡¶ø‡¶¨‡¶∞‡¶£"></td>
                        <td><input type="number" class="quantity" value="1" min="1" oninput="calculateRow(this)"></td>
                        <td><input type="number" class="price" value="0" min="0" oninput="calculateRow(this)"></td>
                        <td><input type="text" class="amount" value="0.00" readonly></td>
                        <td><button class="btn btn-remove" onclick="removeRow(this)">üóëÔ∏è</button></td>
                    </tr>
                </tbody>
            </table>
        </div>
        <button class="btn btn-add" onclick="addRow()">+ ‡¶®‡¶§‡ßÅ‡¶® ‡¶™‡¶£‡ßç‡¶Ø ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®</button>
        <div class="totals-container">
            <table class="totals-table">
                <tbody>
                    <tr><td>‡¶Æ‡ßã‡¶ü</td><td class="text-right" id="grand-total">0.00</td></tr>
                    <tr><td>‡¶Ö‡¶ó‡ßç‡¶∞‡¶ø‡¶Æ</td><td><input type="number" id="advance" value="0" min="0" oninput="calculateTotals()" style="text-align:right; width: 120px; padding: 8px;"></td></tr>
                    <tr><td><strong>‡¶¨‡¶æ‡¶ï‡¶ø</strong></td><td class="text-right" id="due"><strong>0.00</strong></td></tr>
                </tbody>
            </table>
        </div>
        <div class="clearfix"></div>
        <button class="btn btn-print" onclick="printAndSaveBill()">‡¶Æ‡ßá‡¶Æ‡ßã ‡¶™‡ßç‡¶∞‡¶ø‡¶®‡ßç‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶® üìÑ</button>
    </div>

    <!-- History Modal -->
    <div id="historyModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶ø‡¶§ ‡¶Æ‡ßá‡¶Æ‡ßã‡¶∞ ‡¶§‡¶æ‡¶≤‡¶ø‡¶ï‡¶æ</h2>
                <span class="modal-close-btn">&times;</span>
            </div>
            <ul id="history-list"></ul>
        </div>
    </div>

    <script>
        // --- Navigation ---
        function openNav() { document.getElementById("mySidenav").style.width = "250px"; }
        function closeNav() { document.getElementById("mySidenav").style.width = "0"; }

        // --- Core Bill Functions ---
        document.getElementById('delivery-date').valueAsDate = new Date();
        function updateSerialNumbers(){document.querySelectorAll('#bill-table tbody tr').forEach((row,index)=>{row.cells[0].textContent=index+1})}
        function calculateRow(element){let row=element.closest('tr'),quantity=parseFloat(row.querySelector('.quantity').value)||0,price=parseFloat(row.querySelector('.price').value)||0;row.querySelector('.amount').value=(quantity*price).toFixed(2);calculateTotals()}
        function calculateTotals(){let grandTotal=0;document.querySelectorAll('.amount').forEach(field=>{grandTotal+=parseFloat(field.value)||0});document.getElementById('grand-total').innerText=grandTotal.toFixed(2);let advance=parseFloat(document.getElementById('advance').value)||0;document.getElementById('due').innerText=(grandTotal-advance).toFixed(2)}
        function addRow(){let tableBody=document.querySelector('#bill-table tbody');let newRow=tableBody.insertRow();newRow.innerHTML=`<td></td><td><input type="text" class="product-name" placeholder="‡¶™‡¶£‡ßç‡¶Ø‡ßá‡¶∞ ‡¶¨‡¶ø‡¶¨‡¶∞‡¶£"></td><td><input type="number" class="quantity" value="1" min="1" oninput="calculateRow(this)"></td><td><input type="number" class="price" value="0" min="0" oninput="calculateRow(this)"></td><td><input type="text" class="amount" value="0.00" readonly></td><td><button class="btn btn-remove" onclick="removeRow(this)">üóëÔ∏è</button></td>`;updateSerialNumbers()}
        function removeRow(button){if(document.querySelectorAll('#bill-table tbody tr').length>1){button.closest('tr').remove();calculateTotals();updateSerialNumbers()}else{alert("‡¶∂‡ßá‡¶∑ ‡¶∏‡¶æ‡¶∞‡¶ø‡¶ü‡¶ø ‡¶Æ‡ßã‡¶õ‡¶æ ‡¶Ø‡¶æ‡¶¨‡ßá ‡¶®‡¶æ‡•§")}}
        function numberToWordsBengali(num){const single=['','‡¶è‡¶ï','‡¶¶‡ßÅ‡¶á','‡¶§‡¶ø‡¶®','‡¶ö‡¶æ‡¶∞','‡¶™‡¶æ‡¶Å‡¶ö','‡¶õ‡ßü','‡¶∏‡¶æ‡¶§','‡¶Ü‡¶ü','‡¶®‡ßü'],teens=['‡¶¶‡¶∂','‡¶è‡¶ó‡¶æ‡¶∞‡ßã','‡¶¨‡¶æ‡¶∞‡ßã','‡¶§‡ßá‡¶∞‡ßã','‡¶ö‡ßã‡¶¶‡ßç‡¶¶','‡¶™‡¶®‡ßá‡¶∞‡ßã','‡¶∑‡ßã‡¶≤‡ßã','‡¶∏‡¶§‡ßá‡¶∞‡ßã','‡¶Ü‡¶†‡¶æ‡¶∞‡ßã','‡¶â‡¶®‡¶ø‡¶∂'],tens=['','','‡¶¨‡¶ø‡¶∂','‡¶§‡ßç‡¶∞‡¶ø‡¶∂','‡¶ö‡¶≤‡ßç‡¶≤‡¶ø‡¶∂','‡¶™‡¶û‡ßç‡¶ö‡¶æ‡¶∂','‡¶∑‡¶æ‡¶ü','‡¶∏‡¶§‡ßç‡¶§‡¶∞','‡¶Ü‡¶∂‡¶ø','‡¶®‡¶¨‡ßç‡¶¨‡¶á'],powers=['',' ‡¶π‡¶æ‡¶ú‡¶æ‡¶∞',' ‡¶≤‡¶ï‡ßç‡¶∑',' ‡¶ï‡ßã‡¶ü‡¶ø'];function convert(n){if(n<10)return single[n];if(n<20)return teens[n-10];if(n<100)return tens[Math.floor(n/10)]+(n%10!==0?' '+single[n%10]:'');if(n<1000)return single[Math.floor(n/100)]+' ‡¶∂‡¶§'+(n%100!==0?' '+convert(n%100):'');return convert(Math.floor(n/1000))+' ‡¶π‡¶æ‡¶ú‡¶æ‡¶∞'+(n%1000!==0?' '+convert(n%1000):'')}if(num===0)return'‡¶∂‡ßÇ‡¶®‡ßç‡¶Ø';let words='',i=0;while(num>0){let chunk=(i===0)?num%1000:num%100;if(chunk>0){words=convert(chunk)+powers[i]+' '+words}num=(i===0)?Math.floor(num/1000):Math.floor(num/100);i++}return words.trim()}
        
        // --- History & Storage Functions ---
        function saveBillToHistory() {
            const items = [];
            document.querySelectorAll('#bill-table tbody tr').forEach(row => {
                items.push({
                    name: row.querySelector('.product-name').value,
                    quantity: row.querySelector('.quantity').value,
                    price: row.querySelector('.price').value,
                });
            });

            const memo = {
                id: Date.now(),
                memoNo: document.getElementById('memo-no').value,
                customerName: document.getElementById('customer-name').value,
                customerAddress: document.getElementById('customer-address').value,
                deliveryDate: document.getElementById('delivery-date').value,
                advance: document.getElementById('advance').value,
                items: items,
                dateSaved: new Date().toLocaleDateString('bn-BD')
            };

            let history = JSON.parse(localStorage.getItem('memoHistory')) || [];
            history.unshift(memo);
            localStorage.setItem('memoHistory', JSON.stringify(history));
            alert('‡¶Æ‡ßá‡¶Æ‡ßã ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶£ ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá!');
        }
        
        function displayHistory() {
            const history = JSON.parse(localStorage.getItem('memoHistory')) || [];
            const historyList = document.getElementById('history-list');
            historyList.innerHTML = '';

            if (history.length === 0) {
                historyList.innerHTML = '<li>‡¶ï‡ßã‡¶®‡ßã ‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶ø‡¶§ ‡¶Æ‡ßá‡¶Æ‡ßã ‡¶™‡¶æ‡¶ì‡ßü‡¶æ ‡¶Ø‡¶æ‡ßü‡¶®‡¶ø‡•§</li>';
                return;
            }

            history.forEach(memo => {
                const grandTotal = memo.items.reduce((total, item) => total + (item.quantity * item.price), 0);
                const listItem = document.createElement('li');
                listItem.innerHTML = `
                    <span>
                        <strong>${memo.memoNo || 'N/A'}</strong> - ${memo.customerName || 'N/A'} (${memo.dateSaved}) - ‡¶Æ‡ßã‡¶ü: ${grandTotal.toFixed(2)}
                    </span>
                    <div>
                        <button class="btn btn-add" onclick="printMemoFromHistory(${memo.id})" style="margin-right: 5px; padding: 6px 12px; font-size: 14px;">‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®</button>
                        <button class="btn btn-remove" onclick="loadMemoFromHistory(${memo.id})" style="padding: 6px 12px; font-size: 14px;">‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡ßÅ‡¶®</button>
                    </div>
                `;
                historyList.appendChild(listItem);
            });
        }

        function loadMemoFromHistory(id) {
            const history = JSON.parse(localStorage.getItem('memoHistory')) || [];
            const memo = history.find(m => m.id === id);
            if (!memo) return;

            document.getElementById('memo-no').value = memo.memoNo;
            document.getElementById('customer-name').value = memo.customerName;
            document.getElementById('customer-address').value = memo.customerAddress;
            document.getElementById('delivery-date').value = memo.deliveryDate;
            document.getElementById('advance').value = memo.advance;

            const tableBody = document.querySelector('#bill-table tbody');
            tableBody.innerHTML = '';
            memo.items.forEach(item => {
                let newRow = tableBody.insertRow();
                newRow.innerHTML = `
                    <td></td>
                    <td><input type="text" class="product-name" value="${item.name}"></td>
                    <td><input type="number" class="quantity" value="${item.quantity}" min="1" oninput="calculateRow(this)"></td>
                    <td><input type="number" class="price" value="${item.price}" min="0" oninput="calculateRow(this)"></td>
                    <td><input type="text" class="amount" value="${(item.quantity * item.price).toFixed(2)}" readonly></td>
                    <td><button class="btn btn-remove" onclick="removeRow(this)">üóëÔ∏è</button></td>
                `;
            });

            updateSerialNumbers();
            calculateTotals();
            closeModal();
        }
        
        function printMemoFromHistory(id) {
            const history = JSON.parse(localStorage.getItem('memoHistory')) || [];
            const memo = history.find(m => m.id === id);
            if (!memo) { return; }

            const { memoNo, customerName, customerAddress, deliveryDate, advance, items, dateSaved } = memo;

            let tableRows = '';
            let grandTotal = 0;
            items.forEach((item, index) => {
                const pName = item.name || '';
                const qty = parseFloat(item.quantity) || 0;
                const price = parseFloat(item.price) || 0;
                const amount = qty * price;
                grandTotal += amount;
                tableRows += `<tr><td style="text-align:center;">${index + 1}</td><td>${pName}</td><td class="text-right">${qty}</td><td class="text-right">${price.toFixed(2)}</td><td class="text-right">${amount.toFixed(2)}</td></tr>`;
            });

            const finalAdvance = (parseFloat(advance) || 0).toFixed(2);
            const finalDue = (grandTotal - parseFloat(finalAdvance)).toFixed(2);
            const finalGrandTotal = grandTotal.toFixed(2);
            const amountInWords = numberToWordsBengali(Math.round(grandTotal));
            const formattedDeliveryDate = deliveryDate ? new Date(deliveryDate).toLocaleDateString('bn-BD') : 'N/A';
            const savedOnDate = dateSaved || new Date().toLocaleDateString('bn-BD');
            
            const printContent=`<html><head><title>Memo - ${customerName}</title><link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet"><style>:root{--primary-blue:#4A90E2;--text-dark:#1E293B;--border-color:#E2E8F0}body{font-family:'Poppins',sans-serif;margin:0;padding:20px;font-size:14px;color:var(--text-dark)}.memo-box{padding:25px;max-width:800px;margin:auto;background:white;border:1px solid var(--border-color);border-radius:15px}.header{text-align:center;padding-bottom:15px;margin-bottom:20px}.shop-name{font-size:32px;font-weight:700;margin:0;color:var(--primary-blue)}.proprietor{background-color:#F0F4FF;color:var(--primary-blue);padding:6px 18px;border-radius:20px;font-size:15px;font-weight:600;display:inline-block;margin-top:8px}.header p{margin:4px 0;font-size:13px;color:#64748B}.bismillah{font-size:15px;margin-bottom:10px;font-weight:600}.customer-details{display:grid;grid-template-columns:1fr 1fr;gap:10px 20px;margin-bottom:25px}.info-field{display:flex;align-items:stretch;font-size:14px}.info-field span{font-weight:600;padding:8px 12px;color:white;background-color:var(--primary-blue);border-radius:8px 0 0 8px;display:flex;align-items:center}.info-field p{margin:0;border:1px solid var(--border-color);padding:8px 12px;width:100%;border-radius:0 8px 8px 0;border-left:none}.product-table{width:100%;border-collapse:collapse;margin-top:15px;box-shadow:0 0 15px rgba(0,0,0,0.05);border-radius:10px;overflow:hidden}.product-table th,.product-table td{border:1px solid var(--border-color);padding:10px}.product-table th{background-color:var(--primary-blue);color:white;text-align:center;font-weight:600}.text-right{text-align:right}.footer-content{display:flex;justify-content:flex-end;margin-top:25px}.totals-section{width:300px}.in-words{border:1px solid var(--border-color);padding:10px;font-size:14px;margin-bottom:8px;border-radius:8px;font-weight:500}.totals-table{width:100%;border-collapse:collapse}.totals-table td{padding:8px;border:1px solid var(--border-color);font-weight:600;font-size:15px}.signature-area{display:flex;justify-content:space-between;margin-top:80px;padding:0 10px}.signature-area p{border-top:1px dotted #333;padding-top:8px;font-weight:600;color:var(--text-dark)}.final-note{text-align:center;color:#64748B;padding:8px;margin-top:40px;font-size:13px;font-weight:500;border-top:1px solid var(--border-color)}</style></head><body><div class="memo-box"><p class="bismillah">‡¶¨‡¶ø‡¶∏‡¶Æ‡¶ø‡¶≤‡ßç‡¶≤‡¶æ‡¶π‡¶ø‡¶∞ ‡¶∞‡¶æ‡¶π‡¶Æ‡¶æ‡¶®‡¶ø‡¶∞ ‡¶∞‡¶æ‡¶π‡¶ø‡¶Æ</p><div class="header"><h1 class="shop-name">‡¶Ü‡¶¨‡ßç‡¶¶‡ßÅ‡¶≤‡ßç‡¶≤‡¶æ‡¶π ‡¶á‡¶≤‡ßá‡¶ï‡¶ü‡ßç‡¶∞‡¶ø‡¶ï ‡¶è‡¶®‡ßç‡¶° ‡¶á‡¶≤‡ßá‡¶ï‡¶ü‡ßç‡¶∞‡¶®‡¶ø‡¶ï‡ßç‡¶∏</h1><span class="proprietor">‡¶™‡ßç‡¶∞‡ßã‡¶É ‡¶Æ‡ßã‡¶É ‡¶Ü‡¶¨‡ßç‡¶¶‡ßÅ‡¶≤‡ßç‡¶≤‡¶æ‡¶π ‡¶Æ‡ßã‡¶≤‡ßç‡¶≤‡¶æ</span><p>‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶∏‡¶ï‡¶≤ ‡¶™‡ßç‡¶∞‡¶ï‡¶æ‡¶∞ ‡¶á‡¶≤‡ßá‡¶ï‡¶ü‡ßç‡¶∞‡¶®‡¶ø‡¶ï ‡¶ì ‡¶á‡¶≤‡ßá‡¶ï‡¶ü‡ßç‡¶∞‡¶®‡¶ø‡¶ï‡ßç‡¶∏ ‡¶Ü‡¶á‡¶ü‡ßá‡¶Æ ‡¶∏‡ßÅ‡¶≤‡¶≠ ‡¶Æ‡ßÇ‡¶≤‡ßç‡¶Ø‡ßá ‡¶¨‡¶ø‡¶ï‡ßç‡¶∞‡ßü ‡¶è‡¶¨‡¶Ç ‡¶Æ‡ßá‡¶∞‡¶æ‡¶Æ‡¶§ ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡•§</p><p>‡¶Ø‡ßã‡¶ó‡¶æ‡¶Ø‡ßã‡¶ó: ‡ß¶‡ßß‡ß©‡ß®‡ß¨-‡ßß‡ß≠‡ß¶‡ß≠‡ß≠‡ß≠</p></div><div class="customer-details"><div class="info-field"><span>‡¶®‡¶æ‡¶Æ‡¶É</span><p>${customerName || ''}</p></div><div class="info-field"><span>‡¶Æ‡ßá‡¶Æ‡ßã ‡¶®‡¶Ç:</span><p>${memoNo || 'N/A'}</p></div><div class="info-field"><span>‡¶†‡¶ø‡¶ï‡¶æ‡¶®‡¶æ‡¶É</span><p>${customerAddress || ''}</p></div><div class="info-field"><span>‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ‡¶É</span><p>${savedOnDate}</p></div><div class="info-field" style="grid-column:1/-1"><span>‡¶°‡ßá‡¶≤‡¶ø‡¶≠‡¶æ‡¶∞‡¶ø ‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ‡¶É</span><p>${formattedDeliveryDate}</p></div></div><table class="product-table"><thead><tr><th>‡¶®‡¶Ç</th><th>‡¶¨‡¶ø‡¶¨‡¶∞‡¶£</th><th>‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£</th><th>‡¶¶‡¶∞</th><th>‡¶ü‡¶æ‡¶ï‡¶æ</th></tr></thead><tbody>${tableRows}</tbody></table><div class="footer-content"><div class="totals-section"><div class="in-words"><b>‡¶ï‡¶•‡¶æ‡ßü‡¶É</b> ${amountInWords} ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶Æ‡¶æ‡¶§‡ßç‡¶∞‡•§</div><table class="totals-table"><tr><td>‡¶Æ‡ßã‡¶ü</td><td class="text-right">${finalGrandTotal}</td></tr><tr><td>‡¶Ö‡¶ó‡ßç‡¶∞‡¶ø‡¶Æ</td><td class="text-right">${finalAdvance}</td></tr><tr><td style="background-color:#F8FAFC"><b>‡¶¨‡¶æ‡¶ï‡¶ø</b></td><td class="text-right"><b>${finalDue}</b></td></tr></table></div></div><div class="signature-area"><p>‡¶ï‡ßç‡¶∞‡ßá‡¶§‡¶æ‡¶∞ ‡¶∏‡ßç‡¶¨‡¶æ‡¶ï‡ßç‡¶∑‡¶∞</p><p>‡¶¨‡¶ø‡¶ï‡ßç‡¶∞‡ßá‡¶§‡¶æ‡¶∞ ‡¶∏‡ßç‡¶¨‡¶æ‡¶ï‡ßç‡¶∑‡¶∞</p></div><div class="final-note">‡¶¨‡¶ø‡¶ï‡ßç‡¶∞‡¶ø‡¶§ ‡¶Æ‡¶æ‡¶≤ ‡¶´‡ßá‡¶∞‡¶§ ‡¶®‡ßá‡ßü‡¶æ ‡¶π‡ßü ‡¶®‡¶æ‡•§ ‡¶ß‡¶®‡ßç‡¶Ø‡¶¨‡¶æ‡¶¶‡•§</div></div></body></html>`;
            
            let printWindow=window.open('','','height=800,width=800');printWindow.document.write(printContent);printWindow.document.close();printWindow.focus();setTimeout(()=>{printWindow.print();},250)
        }

        function printAndSaveBill() {
            saveBillToHistory();
            printBill(); 
        }

        function printBill() {
            const memoNo=document.getElementById('memo-no').value||'N/A',customerName=document.getElementById('customer-name').value||'',customerAddress=document.getElementById('customer-address').value||'',deliveryDate=document.getElementById('delivery-date').value?new Date(document.getElementById('delivery-date').value).toLocaleDateString('bn-BD'):'N/A',today=new Date().toLocaleDateString('bn-BD');let tableRows='';document.querySelectorAll('#bill-table tbody tr').forEach((row,index)=>{const pName=row.querySelector('.product-name').value||'',qty=row.querySelector('.quantity').value,price=(parseFloat(row.querySelector('.price').value||0)).toFixed(2),amount=(parseFloat(row.querySelector('.amount').value||0)).toFixed(2);tableRows+=`<tr><td style="text-align:center;">${index+1}</td><td>${pName}</td><td class="text-right">${qty}</td><td class="text-right">${price}</td><td class="text-right">${amount}</td></tr>`});const grandTotal=(parseFloat(document.getElementById('grand-total').innerText)).toFixed(2),advance=(parseFloat(document.getElementById('advance').value||0)).toFixed(2),due=(parseFloat(document.getElementById('due').innerText)).toFixed(2),amountInWords=numberToWordsBengali(Math.round(grandTotal));
            const printContent=`<html><head><title>Memo - ${customerName}</title><link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet"><style>:root{--primary-blue:#4A90E2;--text-dark:#1E293B;--border-color:#E2E8F0}body{font-family:'Poppins',sans-serif;margin:0;padding:20px;font-size:14px;color:var(--text-dark)}.memo-box{padding:25px;max-width:800px;margin:auto;background:white;border:1px solid var(--border-color);border-radius:15px}.header{text-align:center;padding-bottom:15px;margin-bottom:20px}.shop-name{font-size:32px;font-weight:700;margin:0;color:var(--primary-blue)}.proprietor{background-color:#F0F4FF;color:var(--primary-blue);padding:6px 18px;border-radius:20px;font-size:15px;font-weight:600;display:inline-block;margin-top:8px}.header p{margin:4px 0;font-size:13px;color:#64748B}.bismillah{font-size:15px;margin-bottom:10px;font-weight:600}.customer-details{display:grid;grid-template-columns:1fr 1fr;gap:10px 20px;margin-bottom:25px}.info-field{display:flex;align-items:stretch;font-size:14px}.info-field span{font-weight:600;padding:8px 12px;color:white;background-color:var(--primary-blue);border-radius:8px 0 0 8px;display:flex;align-items:center}.info-field p{margin:0;border:1px solid var(--border-color);padding:8px 12px;width:100%;border-radius:0 8px 8px 0;border-left:none}.product-table{width:100%;border-collapse:collapse;margin-top:15px;box-shadow:0 0 15px rgba(0,0,0,0.05);border-radius:10px;overflow:hidden}.product-table th,.product-table td{border:1px solid var(--border-color);padding:10px}.product-table th{background-color:var(--primary-blue);color:white;text-align:center;font-weight:600}.text-right{text-align:right}.footer-content{display:flex;justify-content:flex-end;margin-top:25px}.totals-section{width:300px}.in-words{border:1px solid var(--border-color);padding:10px;font-size:14px;margin-bottom:8px;border-radius:8px;font-weight:500}.totals-table{width:100%;border-collapse:collapse}.totals-table td{padding:8px;border:1px solid var(--border-color);font-weight:600;font-size:15px}.signature-area{display:flex;justify-content:space-between;margin-top:80px;padding:0 10px}.signature-area p{border-top:1px dotted #333;padding-top:8px;font-weight:600;color:var(--text-dark)}.final-note{text-align:center;color:#64748B;padding:8px;margin-top:40px;font-size:13px;font-weight:500;border-top:1px solid var(--border-color)}</style></head><body><div class="memo-box"><p class="bismillah">‡¶¨‡¶ø‡¶∏‡¶Æ‡¶ø‡¶≤‡ßç‡¶≤‡¶æ‡¶π‡¶ø‡¶∞ ‡¶∞‡¶æ‡¶π‡¶Æ‡¶æ‡¶®‡¶ø‡¶∞ ‡¶∞‡¶æ‡¶π‡¶ø‡¶Æ</p><div class="header"><h1 class="shop-name">‡¶Ü‡¶¨‡ßç‡¶¶‡ßÅ‡¶≤‡ßç‡¶≤‡¶æ‡¶π ‡¶á‡¶≤‡ßá‡¶ï‡¶ü‡ßç‡¶∞‡¶ø‡¶ï ‡¶è‡¶®‡ßç‡¶° ‡¶á‡¶≤‡ßá‡¶ï‡¶ü‡ßç‡¶∞‡¶®‡¶ø‡¶ï‡ßç‡¶∏</h1><span class="proprietor">‡¶™‡ßç‡¶∞‡ßã‡¶É ‡¶Æ‡ßã‡¶É ‡¶Ü‡¶¨‡ßç‡¶¶‡ßÅ‡¶≤‡ßç‡¶≤‡¶æ‡¶π ‡¶Æ‡ßã‡¶≤‡ßç‡¶≤‡¶æ</span><p>‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶∏‡¶ï‡¶≤ ‡¶™‡ßç‡¶∞‡¶ï‡¶æ‡¶∞ ‡¶á‡¶≤‡ßá‡¶ï‡¶ü‡ßç‡¶∞‡¶®‡¶ø‡¶ï ‡¶ì ‡¶á‡¶≤‡ßá‡¶ï‡¶ü‡ßç‡¶∞‡¶®‡¶ø‡¶ï‡ßç‡¶∏ ‡¶Ü‡¶á‡¶ü‡ßá‡¶Æ ‡¶∏‡ßÅ‡¶≤‡¶≠ ‡¶Æ‡ßÇ‡¶≤‡ßç‡¶Ø‡ßá ‡¶¨‡¶ø‡¶ï‡ßç‡¶∞‡ßü ‡¶è‡¶¨‡¶Ç ‡¶Æ‡ßá‡¶∞‡¶æ‡¶Æ‡¶§ ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡•§</p><p>‡¶Ø‡ßã‡¶ó‡¶æ‡¶Ø‡ßã‡¶ó: ‡ß¶‡ßß‡ß©‡ß®‡ß¨-‡ßß‡ß≠‡ß¶‡ß≠‡ß≠‡ß≠</p></div><div class="customer-details"><div class="info-field"><span>‡¶®‡¶æ‡¶Æ‡¶É</span><p>${customerName}</p></div><div class="info-field"><span>‡¶Æ‡ßá‡¶Æ‡ßã ‡¶®‡¶Ç:</span><p>${memoNo}</p></div><div class="info-field"><span>‡¶†‡¶ø‡¶ï‡¶æ‡¶®‡¶æ‡¶É</span><p>${customerAddress}</p></div><div class="info-field"><span>‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ‡¶É</span><p>${today}</p></div><div class="info-field" style="grid-column:1/-1"><span>‡¶°‡ßá‡¶≤‡¶ø‡¶≠‡¶æ‡¶∞‡¶ø ‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ‡¶É</span><p>${deliveryDate}</p></div></div><table class="product-table"><thead><tr><th>‡¶®‡¶Ç</th><th>‡¶¨‡¶ø‡¶¨‡¶∞‡¶£</th><th>‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£</th><th>‡¶¶‡¶∞</th><th>‡¶ü‡¶æ‡¶ï‡¶æ</th></tr></thead><tbody>${tableRows}</tbody></table><div class="footer-content"><div class="totals-section"><div class="in-words"><b>‡¶ï‡¶•‡¶æ‡ßü‡¶É</b> ${amountInWords} ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶Æ‡¶æ‡¶§‡ßç‡¶∞‡•§</div><table class="totals-table"><tr><td>‡¶Æ‡ßã‡¶ü</td><td class="text-right">${grandTotal}</td></tr><tr><td>‡¶Ö‡¶ó‡ßç‡¶∞‡¶ø‡¶Æ</td><td class="text-right">${advance}</td></tr><tr><td style="background-color:#F8FAFC"><b>‡¶¨‡¶æ‡¶ï‡¶ø</b></td><td class="text-right"><b>${due}</b></td></tr></table></div></div><div class="signature-area"><p>‡¶ï‡ßç‡¶∞‡ßá‡¶§‡¶æ‡¶∞ ‡¶∏‡ßç‡¶¨‡¶æ‡¶ï‡ßç‡¶∑‡¶∞</p><p>‡¶¨‡¶ø‡¶ï‡ßç‡¶∞‡ßá‡¶§‡¶æ‡¶∞ ‡¶∏‡ßç‡¶¨‡¶æ‡¶ï‡ßç‡¶∑‡¶∞</p></div><div class="final-note">‡¶¨‡¶ø‡¶ï‡ßç‡¶∞‡¶ø‡¶§ ‡¶Æ‡¶æ‡¶≤ ‡¶´‡ßá‡¶∞‡¶§ ‡¶®‡ßá‡ßü‡¶æ ‡¶π‡ßü ‡¶®‡¶æ‡•§ ‡¶ß‡¶®‡ßç‡¶Ø‡¶¨‡¶æ‡¶¶‡•§</div></div></body></html>`;
            let printWindow=window.open('','','height=800,width=800');printWindow.document.write(printContent);printWindow.document.close();printWindow.focus();setTimeout(()=>{printWindow.print();},250)
        }
        
        // --- Modal Event Listeners ---
        const modal = document.getElementById("historyModal");
        const showHistoryBtn = document.getElementById("show-history-btn");
        const closeBtn = document.querySelector(".modal-close-btn");

        function closeModal() { modal.style.display = "none"; }
        showHistoryBtn.onclick = function() {
            displayHistory();
            modal.style.display = "block";
            closeNav();
        }
        closeBtn.onclick = closeModal;
        window.onclick = function(event) {
            if (event.target == modal) {
                closeModal();
            }
        }
        
        document.addEventListener('DOMContentLoaded', calculateTotals);
    </script>
</body>
</html>